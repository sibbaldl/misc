var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),BABYLON;!function(n){var l=function(){function t(n,t,i,r){if(void 0===i&&(i=!0),void 0===r&&(r={}),this.register=null,this.dispose=null,this.tick=!1,this._engine=null,this._scene=null,this._before=null,this._after=null,this._started=!1,this._initialized=!1,this._properties=null,this._manager=null,this.owned=null,null==n)throw new Error("Null owner scene obejct specified.");if(null==t)throw new Error("Null host scene obejct specified.");this.tick=i;this.owned=n;this._started=!1;this._manager=null;this._initialized=!1;this._properties=r;this._engine=t.getEngine();this._scene=t;var u=this;u.register=function(){u.registerInstance(u)};u._before=function(){u.updateInstance(u)};u._after=function(){u.afterInstance(u)};u.dispose=function(){u.disposeInstance(u)}}return t.prototype.start=function(){},t.prototype.update=function(){},t.prototype.after=function(){},t.prototype.destroy=function(){},Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"engine",{get:function(){return this._engine},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"manager",{get:function(){return null==this._manager&&(this._manager=n.SceneManager.GetInstance()),this._manager},enumerable:!0,configurable:!0}),t.prototype.setProperty=function(n,t){null!=this._properties&&(this._properties[n]=t)},t.prototype.getProperty=function(n,t){void 0===t&&(t=null);var i=null;return null!=this._properties&&(i=this._properties[n]),null==i&&(i=t),null!=i?i:null},t.prototype.getClassname=function(){var n=/function (.{1,})\(/.exec(this.constructor.toString());return n&&n.length>1?n[1]:""},t.prototype.getMetadata=function(){return this.manager.findSceneMetadata(this.owned)},t.prototype.getComponent=function(n){var t=this.manager.findSceneComponent(n,this.owned);return null!=t?t:null},t.prototype.getComponents=function(n){var t=this.manager.findSceneComponents(n,this.owned);return null!=t?t:null},t.prototype.getLensFlareSystem=function(n){return this.manager.findSceneLensFlareSystem(n,this.owned)},t.prototype.getLensFlareSystems=function(){return this.manager.findSceneLensFlareSystems(this.owned)},t.prototype.init=function(){null!=this.owned.metadata},t.prototype.registerInstance=function(n){n.ready&&n.manager.onready(function(){n.ready()});n.scene.registerBeforeRender(n._before);n.scene.registerAfterRender(n._after)},t.prototype.updateInstance=function(n){n._started?n._started&&n.tick&&(n.update(),n.updateIntersectionList&&n.updateIntersectionList()):(n.init(),n.start(),n._started=!0)},t.prototype.afterInstance=function(n){n._started&&n.tick&&n.after()},t.prototype.disposeInstance=function(n){n.scene.unregisterBeforeRender(n._before);n.scene.unregisterAfterRender(n._after);n.disposeSceneComponent&&n.disposeSceneComponent();null!=n._prefab&&(n._prefab.dispose(),n._prefab=null);n.destroy();n.tick=!1;n.owned=null;n._started=!1;n._before=null;n._after=null;n._properties=null;n._engine=null;n._scene=null;n._manager=null;n.register=null;n.dispose=null},t}(),t,i,r,u,f,e,o,s,h,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,c;n.SceneComponent=l;t=function(t){function i(n,i,r,u){void 0===r&&(r=!0);void 0===u&&(u={});var f=t.call(this,n,i,r,u)||this;return f._camera=null,f._orthoSize=0,f._orthoUpdate=!1,f._camera=n,f}return __extends(i,t),Object.defineProperty(i.prototype,"camera",{get:function(){return this._camera},enumerable:!0,configurable:!0}),i.prototype.setupOrthographicCamera=function(t,i){null!=this.camera&&this._camera.mode===n.Camera.ORTHOGRAPHIC_CAMERA&&(this._orthoSize=t,this.updateOrthographicSize(),this._orthoUpdate===!1&&(this._orthoUpdate=i,this._orthoUpdate===!0&&window.addEventListener("resize",this.updateOrthographicSize)))},i.prototype.updateOrthographicSize=function(){if(null!=this.camera&&0!==this._orthoSize){var t=this.scene.getEngine().getRenderingCanvasClientRect(),r=t.width/t.height,n=this._orthoSize,i=n*r;this._camera.orthoTop=n;this._camera.orthoBottom=-n;this._camera.orthoLeft=-i;this._camera.orthoRight=i}},i.prototype.disposeSceneComponent=function(){this._orthoUpdate===!0&&(window.removeEventListener("resize",this.updateOrthographicSize),this._orthoUpdate=!1,this._orthoSize=0);null!=this._camera.metadata&&null!=this._camera.metadata.properties&&null!=this._camera.metadata.properties.hdrPipeline&&(this._camera.metadata.properties.hdrPipeline=null);this._camera=null},i}(n.SceneComponent);n.CameraComponent=t;i=function(n){function t(t,i,r,u){void 0===r&&(r=!0);void 0===u&&(u={});var f=n.call(this,t,i,r,u)||this;return f._light=null,f._light=t,f}return __extends(t,n),Object.defineProperty(t.prototype,"light",{get:function(){return this._light},enumerable:!0,configurable:!0}),t.prototype.disposeSceneComponent=function(){this._light=null},t}(n.SceneComponent);n.LightComponent=i;r=function(t){function i(i,r,u,f){void 0===u&&(u=!0);void 0===f&&(f={});var e=t.call(this,i,r,u,f)||this;return e.onIntersectionEnter=null,e.onIntersectionStay=null,e.onIntersectionExit=null,e.intersectionPrecision=n.IntersectionPrecision.AABB,e._intersections=[],e._intersecting=!1,e._intersector=null,e._mesh=null,e._mesh=i,e._intersecting=!1,e}return __extends(i,t),Object.defineProperty(i.prototype,"mesh",{get:function(){return this._mesh},enumerable:!0,configurable:!0}),i.prototype.getChildMesh=function(t,i,r,u){return void 0===i&&(i=n.SearchType.ExactMatch),void 0===r&&(r=!0),void 0===u&&(u=null),this.manager.findSceneChildMesh(t,this._mesh,i,r,u)},i.prototype.getCollisionMesh=function(n,t){return void 0===n&&(n=!0),void 0===t&&(t=null),this.manager.findSceneCollisionMesh(this._mesh,n,t)},i.prototype.getSocketMesh=function(n,t,i){return void 0===t&&(t=!0),void 0===i&&(i=null),this.manager.findSceneSocketMesh(n,this._mesh,t,i)},i.prototype.getSocketMeshes=function(n,t){return void 0===n&&(n=!0),void 0===t&&(t=null),this.manager.findSceneSocketMeshes(this._mesh,n,t)},i.prototype.getParticleSystem=function(n){return this.manager.findSceneParticleSystem(n,this._mesh)},i.prototype.getParticleSystems=function(){return this.manager.findSceneParticleSystems(this._mesh)},i.prototype.onCollisionEvent=function(t){if(null!=this._mesh.metadata&&this._mesh.metadata.api&&(this._mesh.metadata.collisionEvent=t),null!=this._mesh.physicsImpostor){var i=this._mesh.physicsImpostor;null==i.onCollideEvent&&(i.onCollideEvent=this.updatePhysicsCollisionEvent)}else n.Tools.Warn("Physics imposter not defined for mesh: "+this.mesh.name)},i.prototype.getCollisionEventHandler=function(){var n=null;return null!=this._mesh.metadata&&this._mesh.metadata.api&&null!=this._mesh.metadata.collisionEvent&&(n=this._mesh.metadata.collisionEvent),n},i.prototype.updatePhysicsCollisionEvent=function(n,t){var r,i,u;null!=n.object&&null!=t.object&&(r=n.object,null!=r&&null!=r.metadata&&null!=r.metadata.collisionEvent&&(i=t.object,null!=i&&(u="Untagged",null!=i.metadata&&null!=i.metadata.tagName&&""!==i.metadata.tagName&&(u=i.metadata.tagName),r.metadata.collisionEvent(i,u))))},i.prototype.addIntersectionMesh=function(n){if(null!=n){var t=this.manager.findSceneCollisionMesh(n);null!=t&&this._intersections.push({mesh:t,intersecting:!1})}},i.prototype.addIntersectionMeshes=function(n){var t=this;null!=n&&n.forEach(function(n){if(null!=n){var i=t.manager.findSceneCollisionMesh(n);null!=i&&t._intersections.push({mesh:i,intersecting:!1})}})},i.prototype.removeIntersectionMesh=function(n){var r;if(null!=n&&null!=this._intersections&&this._intersections.length>0){for(var u=this._intersections.length,i=-1,t=0,t=0;t<u;t++)if(r=this._intersections[t],null!=r.mesh&&r.mesh===n){i=t;break}i>=0&&this._intersections.splice(i,1)}},i.prototype.getIntersectionList=function(){return this._intersections},i.prototype.resetIntersectionList=function(){this._intersections=[]},i.prototype.updateIntersectionList=function(){var t=this;null==this._intersector&&(this._intersector=this.getCollisionMesh());null!=this._intersector&&null!=this._intersections&&this._intersections.length>0&&this._intersections.forEach(function(i){null!=i.mesh&&(t._intersecting=t._intersector.intersectsMesh(i.mesh,t.intersectionPrecision===n.IntersectionPrecision.OBB),t._intersecting?i.intersecting?null!=t.onIntersectionStay&&t.onIntersectionStay(i.mesh):null!=t.onIntersectionEnter&&t.onIntersectionEnter(i.mesh):i.intersecting&&null!=t.onIntersectionExit&&t.onIntersectionExit(i.mesh),i.intersecting=t._intersecting)})},i.prototype.disposeSceneComponent=function(){if(this.resetIntersectionList(),null!=this.mesh){if(null!=this._mesh.skeleton&&null!=this.mesh.skeleton.bones&&this._mesh.skeleton.bones.length>0&&this.mesh.skeleton.bones.forEach(function(n){null!=n&&null!=n.metadata&&(n.metadata=null)}),null!=this._mesh.physicsImpostor){var n=this._mesh.physicsImpostor;null!=n.onCollideEvent&&(n.onCollideEvent=null)}null!=this._mesh.metadata&&this._mesh.metadata.api&&(this._mesh.metadata.collisionEvent=null)}this._intersector=null;this._mesh=null},i}(n.SceneComponent);n.MeshComponent=r;u=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.start=function(){var n=this,t,i;n.setupOrthographicCamera&&(t=this.getProperty("orthoSize",5),i=this.getProperty("resizeCameras",!0),n.setupOrthographicCamera(t,i))},t}(n.CameraComponent);n.OrthoController=u;f=function(){function t(){this.currentVelocity=0}return t.prototype.SmoothDamp=function(t,i,r,u,f){var l,s;void 0===f&&(f=Number.MAX_VALUE);r=Math.max(.0001,r);var c=2/r,e=c*u,a=1/(1+e+.48*e*e+.235*e*e*e),o=t-i,h=i,v=f*r;return o=n.Scalar.Clamp(o,-v,v),i=t-o,l=(this.currentVelocity+c*o)*u,this.currentVelocity=(this.currentVelocity-c*l)*a,s=i+(o+l)*a,h-t>0==s>h&&(s=h,this.currentVelocity=(s-h)/u),s},t.prototype.SmoothDampAngle=function(t,i,r,u,f){return void 0===f&&(f=Number.MAX_VALUE),i=t+n.Scalar.DeltaAngle(t,i),this.SmoothDamp(t,i,r,f,u)},t}();n.SmoothTool=f;e=function(){function t(t){this._owned=null;this.slerpIdentity=null;this._owned=t;this.slerpIdentity=n.Quaternion.Identity()}return t.prototype.rotate=function(t,i,r,u){void 0===u&&(u=n.RotateOrder.ZXY);var f=null;return null!=this._owned&&(null==this._owned.rotationQuaternion&&(this._owned.rotationQuaternion=n.Quaternion.RotationYawPitchRoll(this._owned.rotation.y,this._owned.rotation.x,this._owned.rotation.z)),f=u===n.RotateOrder.XYZ?this._owned.addRotation(t,0,0).addRotation(0,i,0).addRotation(0,0,r):u===n.RotateOrder.XZY?this._owned.addRotation(t,0,0).addRotation(0,0,r).addRotation(0,i,0):u===n.RotateOrder.ZXY?this._owned.addRotation(0,0,r).addRotation(t,0,0).addRotation(0,i,0):u===n.RotateOrder.ZYX?this._owned.addRotation(0,0,r).addRotation(0,i,0).addRotation(t,0,0):u===n.RotateOrder.YZX?this._owned.addRotation(0,i,0).addRotation(0,0,r).addRotation(t,0,0):this._owned.addRotation(t,i,r)),f},t.prototype.lookAtPosition=function(t,i,r,u,f,e){void 0===i&&(i=0);var o=null;return null!=this._owned&&(null==this._owned.rotationQuaternion&&(this._owned.rotationQuaternion=n.Quaternion.RotationYawPitchRoll(this._owned.rotation.y,this._owned.rotation.x,this._owned.rotation.z)),null!=this.slerpIdentity&&i>0&&this.slerpIdentity.copyFrom(this._owned.rotationQuaternion),o=this._owned.lookAt(t,r,u,f,e),null!=this.slerpIdentity&&i>0&&n.Quaternion.SlerpToRef(this.slerpIdentity,this._owned.rotationQuaternion,i,this._owned.rotationQuaternion)),o},t.prototype.dispose=function(){this._owned=null;this.slerpIdentity=null},t}();n.MeshRotator=e;o=function(){function n(n){this._metadata=null;this._metadata=n}return Object.defineProperty(n.prototype,"type",{get:function(){return this._metadata.type},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"prefab",{get:function(){return this._metadata.prefab},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"state",{get:function(){return this._metadata.state},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"objectId",{get:function(){return this._metadata.objectId},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"objectName",{get:function(){return this._metadata.objectName},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"tagName",{get:function(){return this._metadata.tagName},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"layerIndex",{get:function(){return this._metadata.layerIndex},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"layerName",{get:function(){return this._metadata.layerName},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"areaIndex",{get:function(){return this._metadata.areaIndex},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"navAgent",{get:function(){return this._metadata.navAgent},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"meshLink",{get:function(){return this._metadata.meshLink},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"meshObstacle",{get:function(){return this._metadata.meshObstacle},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"socketList",{get:function(){return this._metadata.socketList},enumerable:!0,configurable:!0}),n.prototype.setProperty=function(n,t){null!=this._metadata.properties&&(this._metadata.properties[n]=t)},n.prototype.getProperty=function(n,t){void 0===t&&(t=null);var i=null;return null!=this._metadata.properties&&(i=this._metadata.properties[n]),null==i&&(i=t),null!=i?i:null},n}();n.ObjectMetadata=o;s=function(){function n(){}return n}();n.MachineState=s;h=function(){function n(){}return n}();n.TransitionCheck=h;!function(n){n[n.YXZ=0]="YXZ";n[n.YZX=1]="YZX";n[n.XYZ=2]="XYZ";n[n.XZY=3]="XZY";n[n.ZXY=4]="ZXY";n[n.ZYX=5]="ZYX"}(a=n.RotateOrder||(n.RotateOrder={}));!function(n){n[n.Clip=0]="Clip";n[n.Tree=1]="Tree"}(v=n.MotionType||(n.MotionType={}));!function(n){n[n.Float=1]="Float";n[n.Int=3]="Int";n[n.Bool=4]="Bool";n[n.Trigger=9]="Trigger"}(y=n.AnimatorParameterType||(n.AnimatorParameterType={}));!function(n){n[n.Deg2Rad=.0174532924]="Deg2Rad";n[n.Rad2Deg=57.29578]="Rad2Deg";n[n.DiagonalSpeed=.7071]="DiagonalSpeed";n[n.MinimumTimeout=.25]="MinimumTimeout"}(p=n.Constants||(n.Constants={}));!function(n){n[n.ExactMatch=0]="ExactMatch";n[n.StartsWith=1]="StartsWith";n[n.EndsWith=2]="EndsWith";n[n.IndexOf=3]="IndexOf"}(w=n.SearchType||(n.SearchType={}));!function(n){n[n.None=-1]="None";n[n.Generic=0]="Generic";n[n.Xbox360=1]="Xbox360"}(b=n.GamepadType||(n.GamepadType={}));!function(n){n[n.Left=0]="Left";n[n.Right=1]="Right"}(k=n.JoystickButton||(n.JoystickButton={}));!function(n){n[n.Left=0]="Left";n[n.Right=1]="Right"}(d=n.Xbox360Trigger||(n.Xbox360Trigger={}));!function(n){n[n.Left=0]="Left";n[n.Middle=1]="Middle";n[n.Right=2]="Right"}(g=n.UserInputPointer||(n.UserInputPointer={}));!function(n){n[n.Horizontal=0]="Horizontal";n[n.Vertical=1]="Vertical";n[n.ClientX=2]="ClientX";n[n.ClientY=3]="ClientY";n[n.MouseX=4]="MouseX";n[n.MouseY=5]="MouseY";n[n.Wheel=6]="Wheel"}(nt=n.UserInputAxis||(n.UserInputAxis={}));!function(n){n[n.BackSpace=8]="BackSpace";n[n.Tab=9]="Tab";n[n.Enter=13]="Enter";n[n.Shift=16]="Shift";n[n.Ctrl=17]="Ctrl";n[n.Alt=18]="Alt";n[n.Pause=19]="Pause";n[n.Break=19]="Break";n[n.CapsLock=20]="CapsLock";n[n.Escape=27]="Escape";n[n.SpaceBar=32]="SpaceBar";n[n.PageUp=33]="PageUp";n[n.PageDown=34]="PageDown";n[n.End=35]="End";n[n.Home=36]="Home";n[n.LeftArrow=37]="LeftArrow";n[n.UpArrow=38]="UpArrow";n[n.RightArrow=39]="RightArrow";n[n.DownArrow=40]="DownArrow";n[n.Insert=45]="Insert";n[n.Delete=46]="Delete";n[n.Num0=48]="Num0";n[n.Num1=49]="Num1";n[n.Num2=50]="Num2";n[n.Num3=51]="Num3";n[n.Num4=52]="Num4";n[n.Num5=53]="Num5";n[n.Num6=54]="Num6";n[n.Num7=55]="Num7";n[n.Num8=56]="Num8";n[n.Num9=57]="Num9";n[n.A=65]="A";n[n.B=66]="B";n[n.C=67]="C";n[n.D=68]="D";n[n.E=69]="E";n[n.F=70]="F";n[n.G=71]="G";n[n.H=72]="H";n[n.I=73]="I";n[n.J=74]="J";n[n.K=75]="K";n[n.L=76]="L";n[n.M=77]="M";n[n.N=78]="N";n[n.O=79]="O";n[n.P=80]="P";n[n.Q=81]="Q";n[n.R=82]="R";n[n.S=83]="S";n[n.T=84]="T";n[n.U=85]="U";n[n.V=86]="V";n[n.W=87]="W";n[n.X=88]="X";n[n.Y=89]="Y";n[n.Z=90]="Z";n[n.LeftWindowKey=91]="LeftWindowKey";n[n.RightWindowKey=92]="RightWindowKey";n[n.SelectKey=93]="SelectKey";n[n.Numpad0=96]="Numpad0";n[n.Numpad1=97]="Numpad1";n[n.Numpad2=98]="Numpad2";n[n.Numpad3=99]="Numpad3";n[n.Numpad4=100]="Numpad4";n[n.Numpad5=101]="Numpad5";n[n.Numpad6=102]="Numpad6";n[n.Numpad7=103]="Numpad7";n[n.Numpad8=104]="Numpad8";n[n.Numpad9=105]="Numpad9";n[n.Multiply=106]="Multiply";n[n.Add=107]="Add";n[n.Subtract=109]="Subtract";n[n.DecimalPoint=110]="DecimalPoint";n[n.Divide=111]="Divide";n[n.F1=112]="F1";n[n.F2=113]="F2";n[n.F3=114]="F3";n[n.F4=115]="F4";n[n.F5=116]="F5";n[n.F6=117]="F6";n[n.F7=118]="F7";n[n.F8=119]="F8";n[n.F9=120]="F9";n[n.F10=121]="F10";n[n.F11=122]="F11";n[n.F12=123]="F12";n[n.NumLock=144]="NumLock";n[n.ScrollLock=145]="ScrollLock";n[n.SemiColon=186]="SemiColon";n[n.EqualSign=187]="EqualSign";n[n.Comma=188]="Comma";n[n.Dash=189]="Dash";n[n.Period=190]="Period";n[n.ForwardSlash=191]="ForwardSlash";n[n.GraveAccent=192]="GraveAccent";n[n.OpenBracket=219]="OpenBracket";n[n.BackSlash=220]="BackSlash";n[n.CloseBraket=221]="CloseBraket";n[n.SingleQuote=222]="SingleQuote"}(tt=n.UserInputKey||(n.UserInputKey={}));!function(n){n[n.DirectVelocity=0]="DirectVelocity";n[n.AppliedForces=1]="AppliedForces"}(it=n.MovementType||(n.MovementType={}));!function(n){n[n.Top=0]="Top";n[n.Left=1]="Left";n[n.Right=2]="Right";n[n.Bottom=3]="Bottom"}(rt=n.CollisionContact||(n.CollisionContact={}));!function(n){n[n.AABB=0]="AABB";n[n.OBB=1]="OBB"}(ut=n.IntersectionPrecision||(n.IntersectionPrecision={}));!function(n){n[n.If=1]="If";n[n.IfNot=2]="IfNot";n[n.Greater=3]="Greater";n[n.Less=4]="Less";n[n.Equals=6]="Equals";n[n.NotEqual=7]="NotEqual"}(ft=n.ConditionMode||(n.ConditionMode={}));!function(n){n[n.None=0]="None";n[n.Source=1]="Source";n[n.Destination=2]="Destination";n[n.SourceThenDestination=3]="SourceThenDestination";n[n.DestinationThenSource=4]="DestinationThenSource"}(et=n.InterruptionSource||(n.InterruptionSource={}));!function(n){n[n.Simple1D=0]="Simple1D";n[n.SimpleDirectional2D=1]="SimpleDirectional2D";n[n.FreeformDirectional2D=2]="FreeformDirectional2D";n[n.FreeformCartesian2D=3]="FreeformCartesian2D";n[n.Direct=4]="Direct"}(ot=n.BlendTreeType||(n.BlendTreeType={}));c=function(){function n(){}return n.JoystickRightHandleColor="yellow",n.JoystickLeftSensibility=1,n.JoystickRightSensibility=1,n.JoystickDeadStickValue=.1,n.GamepadDeadStickValue=.25,n.GamepadLStickXInverted=!1,n.GamepadLStickYInverted=!1,n.GamepadRStickXInverted=!1,n.GamepadRStickYInverted=!1,n.GamepadLStickSensibility=1,n.GamepadRStickSensibility=1,n.PointerAngularSensibility=1,n.PointerWheelDeadZone=.1,n}();n.UserInputOptions=c}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(t,i){var u,f,r;if(this.onrender=null,this._ie=!1,this._url="",this._time=0,this._timing=!1,this._filename=null,this._render=null,this._running=!1,this._markup="",this._gui="None",this._input=!1,this._scene=null,this._navmesh=null,this._navigation=null,this._mainCamera=null,this._loadQueueIndex=0,this._loadQueueCount=0,this._loadQueueScenes=null,this._localReadyState=null,this._localSceneReady=!1,this.updateCamera=null,this.updateCameraInput=!1,this.cameraInputMoveSpeed=1,this.cameraInputRotateSpeed=.005,this._onready=[],null==i)throw new Error("Null host scene obejct specified.");this._ie=!!document.all;this._url=t;this._time=0;this._timing=!1;this._filename=null;this._scene=i;this._input=!1;this._onready=[];this._navmesh=null;this._navigation=null;this._mainCamera=null;this._loadQueueIndex=0;this._loadQueueCount=0;this._loadQueueScenes=null;this._localSceneReady=!1;this._localReadyState={state:"localReadyState"};this._scene._addPendingData(this._localReadyState);n.SceneManager.me=this;n.SceneManager.engine=this._scene.getEngine();n.SceneManager.prefabs={};n.SceneManager.orphans=null;n.SceneManager.rightHanded=this._scene.useRightHandedSystem;n.SceneManager.staticVertexLimit=!1;n.SceneManager.showDebugSockets=!1;n.SceneManager.colliderVisibility=.25;n.SceneManager.socketColliderSize=.125;this.updateCamera=null;this.updateCameraInput=!1;this.cameraInputMoveSpeed=1;this.cameraInputRotateSpeed=.005;null!=this._scene.metadata&&null!=this._scene.metadata.properties&&(this._scene.metadata.properties.colliderVisibility&&null!=this._scene.metadata.properties.colliderVisibility&&(n.SceneManager.colliderVisibility=this._scene.metadata.properties.colliderVisibility),this._scene.metadata.properties.socketColliderSize&&null!=this._scene.metadata.properties.socketColliderSize&&(n.SceneManager.socketColliderSize=this._scene.metadata.properties.socketColliderSize),this._scene.metadata.properties.hasOwnProperty("showDebugSockets")&&(n.SceneManager.showDebugSockets=this._scene.metadata.properties.showDebugSockets),this._scene.metadata.properties.hasOwnProperty("staticVertexLimit")&&(n.SceneManager.staticVertexLimit=this._scene.metadata.properties.staticVertexLimit));u=[];(n.SceneManager.parseSceneCameras(this._scene.cameras,this._scene,u),n.SceneManager.parseSceneLights(this._scene.lights,this._scene,u),n.SceneManager.parseSceneMeshes(this._scene.meshes,this._scene,u),null!=this._scene.metadata&&null!=this._scene.metadata.properties&&null!=this._scene.metadata.properties.interfaceMode&&(this._gui=this._scene.metadata.properties.interfaceMode,null!=this._scene.metadata.properties.userInterface))&&(f=this._scene.metadata.properties.userInterface,window&&f.embedded&&null!=f.base64&&(this._markup=window.atob(f.base64),this._scene.metadata.properties.autoDraw===!0&&null!=this._gui&&""!==this._gui&&"None"!==this._gui&&null!=this._markup&&""!==this._markup&&this.drawSceneMarkup(this._markup)));u.length>0&&(u.sort(function(n,t){return n.order<t.order?-1:n.order>t.order?1:0}),u.forEach(function(n){n.instance.register()}));r=this;this._render=function(){null!=r&&(r._timing&&null!=n.SceneManager.engine&&(r._time+=r.deltaTime,r._time>=n.SceneManager.max&&(r._time=0)),r._input&&n.SceneManager.updateUserInput(),null!=r._scene&&r._scene.render(),null!=r.onrender&&r.onrender())};this._scene.onDispose=function(){null!=r&&r.dispose()}}return t.GetInstance=function(){return n.SceneManager.me},t.CreateScene=function(t){var i=new n.Scene(t);return n.SceneManager.parseSceneMetadata("/",i),i},t.RegisterLoader=function(t){n.SceneManager.loader=t},t.ExecuteWhenReady=function(t){null!=t&&n.SceneManager.readies.push(t)},t.CreateManagerSession=function(t,i){var r=i;return null!=r.manager&&(r.manager.dispose(),r.manager=null),r.manager=new n.SceneManager(t,i),null!=r.manager&&r.manager._executeWhenReady(),r.manager},Object.defineProperty(t,"StaticIndex",{get:function(){return 30},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PrefabIndex",{get:function(){return 31},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ie",{get:function(){return this._ie},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){return this._time},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"deltaTime",{get:function(){return n.SceneManager.engine.getDeltaTime()/1e3},enumerable:!0,configurable:!0}),t.prototype.getScene=function(){return this._scene},t.prototype.dispose=function(){n.SceneManager.me=null;n.SceneManager.engine=null;n.SceneManager.prefabs=null;n.SceneManager.orphans=null;n.SceneManager.rightHanded=!0;null!=n.SceneManager.orphans&&(n.SceneManager.orphans.dispose(),n.SceneManager.orphans=null);this.disableUserInput();this._gui=null;this._time=0;this._render=null;this._markup=null;this._navmesh=null;this._timing=!1;this._navigation=null;this._onready=null;this.onrender=null;this.updateCamera=null;this.updateCameraInput=!1;this.cameraInputMoveSpeed=1;this.cameraInputRotateSpeed=.005;var t=this._scene;t.manager&&(t.manager=null);t=null;this._scene=null},t.prototype.once=function(n){var r=this,i,t;null!=n&&(i=!1,t=null,t=function(){r._scene.unregisterBeforeRender(t);t=null;i===!1&&(i=!0,n())},this._scene.registerBeforeRender(t))},t.prototype.delay=function(n,t){return window.setTimeout(n,t)},t.prototype.repeat=function(n,t){return window.setInterval(n,t)},t.prototype.clear=function(n){window.clearInterval(n)},t.prototype.enableTime=function(){this._time=0;this._timing=!0},t.prototype.disableTime=function(){this._time=0;this._timing=!1},t.prototype.loadLevel=function(t,i){if(void 0===i&&(i=null),null==n.SceneManager.loader)throw new Error("No scene loader function registered.");var r=null!=i&&""!==i?i:this.getScenePath();this.stop();this.clearSceneMarkup();this._scene.dispose();n.SceneManager.loader(r,t)},t.prototype.importMeshes=function(t,i,r,u){void 0===i&&(i=null);void 0===r&&(r=null);void 0===u&&(u=null);n.SceneLoader.ImportMesh("",this.getScenePath(),t,this._scene,function(){null!=i&&i()},r,u)},t.prototype.safeDestroy=function(n,t,i){void 0===t&&(t=5);void 0===i&&(i=!1);i&&n.setEnabled(!1);this.delay(function(){n.dispose()},t)},t.prototype.getSceneName=function(){if((null==this._filename||""===this._filename)&&null!=this._scene.database&&null!=this._scene.database.currentSceneUrl){var t=this._scene.database.currentSceneUrl,i=t.length,n=t.lastIndexOf("/");n<0?n=0:n++;this._filename=t.substr(n,i)}return null!=this._filename&&""!==this._filename?this._filename:"Unknown.babylon"},t.prototype.getScenePath=function(){if((null==this._url||""===this._url)&&null!=this._scene.database&&null!=this._scene.database.currentSceneUrl){var n=this._scene.database.currentSceneUrl;this._url=n.substr(0,n.lastIndexOf("/"))+"/"}return null!=this._url&&""!==this._url?this._url:"/"},t.prototype.getMainCamera=function(){if(null==this._mainCamera){var n=this._scene.getCamerasByTags("MainCamera");null!=n&&n.length>0&&(this._mainCamera=n[0])}return this._mainCamera},t.prototype.showFullscreen=function(t){void 0===t&&(t=null);var i=null!=t?t:document.documentElement;n.Tools.RequestFullscreen(i);i.focus()},t.prototype.exitFullscreen=function(){n.Tools.ExitFullscreen()},t.prototype.showLoadingScreen=function(t,i,r){void 0===t&&(t="Babylon Toolkit");void 0===i&&(i=null);void 0===r&&(r=!0);var u=window;u.showSceneLoader?u.showSceneLoader(t):(n.SceneManager.engine.loadingUIText=t,n.SceneManager.engine.displayLoadingUI(),r===!0&&(n.SceneLoader.ShowLoadingScreen=!1));null!=i&&this.updateLoadingStatus(i)},t.prototype.freezeLoadingScreen=function(n,t,i){void 0===n&&(n="Babylon Toolkit");void 0===t&&(t=null);void 0===i&&(i=!0);window.show=!1;this.showLoadingScreen(n,t,i)},t.prototype.hideLoadingScreen=function(t){void 0===t&&(t=!0);var i=window;i.removeSceneLoader?i.removeSceneLoader():(n.SceneManager.engine.hideLoadingUI(),t===!0&&(n.SceneLoader.ShowLoadingScreen=!0))},t.prototype.updateLoadingStatus=function(n){var t=window;t.updateStatus&&t.updateStatus(n)},t.prototype.isRunning=function(){return this._running},t.prototype.isMobile=function(){var i=!1,t;return null!=navigator&&null!=navigator.userAgent?(t=navigator.userAgent,(t.match(/Android/i)||t.match(/webOS/i)||t.match(/iPhone/i)||t.match(/iPad/i)||t.match(/iPod/i)||t.match(/BlackBerry/i)||t.match(/Windows Phone/i))&&(i=!0)):n.Tools.Warn("Host navigator user agent is unavailable."),i},t.prototype.onready=function(n){null!=n&&(this._localSceneReady===!0?n():this._onready.push(n))},t.prototype._executeWhenReady=function(){null!=this._scene.metadata&&null!=this._scene.metadata.imports?(this._loadQueueIndex=0,this._loadQueueScenes=this._scene.metadata.imports,this._loadQueueScenes.length>0?(this._loadQueueCount=this._loadQueueScenes.length,this._loadQueueImports()):this._executeLocalReady()):this._executeLocalReady()},t.prototype._executeLocalReady=function(){var u=this,t,i,r;(null!=n.SceneManager.readies&&n.SceneManager.readies.length>0&&n.SceneManager.readies.forEach(function(n){n(u._scene,u)}),n.SceneManager.readies=[],null!=this._onready&&this._onready.length>0&&(this._onready.forEach(function(n){n()}),this._onready=null),this._localSceneReady=!0,null!=this._scene.metadata&&null!=this._scene.metadata.properties&&(this._scene.metadata.properties.timeManagement===!0&&this.enableTime(),this._scene.metadata.properties.enableUserInput===!0))&&(t=this._scene.metadata.properties.userInput,i=t.joystickInputValue,0!==i&&this._scene.metadata.properties.virtualJoystickAttached===!0&&(i=0,n.Tools.Warn("Virtual joystick camera attached, disabled manual joystick input.")),this.enableUserInput({preventDefault:this._scene.metadata.properties.preventDefault,useCapture:this._scene.metadata.properties.useCapture,enableVirtualJoystick:1===i||2===i&&this.isMobile(),disableRightStick:t.disableRightStick}),r=t.joystickRightColorText,null!=r&&""!==r&&(n.UserInputOptions.JoystickRightHandleColor=r),n.UserInputOptions.JoystickLeftSensibility=t.joystickLeftLevel,n.UserInputOptions.JoystickRightSensibility=t.joystickRightLevel,n.UserInputOptions.JoystickDeadStickValue=t.joystickDeadStick,n.UserInputOptions.GamepadDeadStickValue=t.padDeadStick,n.UserInputOptions.GamepadLStickXInverted=t.padLStickXInvert,n.UserInputOptions.GamepadLStickYInverted=t.padLStickYInvert,n.UserInputOptions.GamepadRStickXInverted=t.padRStickXInvert,n.UserInputOptions.GamepadRStickYInverted=t.padRStickYInvert,n.UserInputOptions.GamepadLStickSensibility=t.padLStickLevel,n.UserInputOptions.GamepadRStickSensibility=t.padRStickLevel,n.UserInputOptions.PointerAngularSensibility=t.mouseAngularLevel,n.UserInputOptions.PointerWheelDeadZone=t.wheelDeadZone);null!=this._localReadyState&&(this._scene._removePendingData(this._localReadyState),this._localReadyState=null)},t.prototype._loadQueueImports=function(){var i=this,r=this._loadQueueIndex+1,t;r>this._loadQueueCount?(this._loadQueueIndex=0,this._loadQueueCount=0,this._loadQueueScenes=null,this._executeLocalReady()):(t=this._loadQueueScenes[this._loadQueueIndex],n.Tools.Log("Importing scene meshes: "+t),this._loadQueueIndex++,this.importMeshes(t,function(){i._loadQueueImports()},null,function(t,r){n.Tools.Warn(r);i._loadQueueImports()}))},t.prototype.start=function(){this._running=!0;this._scene.getEngine().runRenderLoop(this._render)},t.prototype.stop=function(){this._running=!1;this._scene.getEngine().stopRenderLoop(this._render)},t.prototype.toggle=function(){this._running?(this.pauseAudio(),this.stop()):(this.resumeAudio(),this.start())},t.prototype.stepFrame=function(){this._running?this.toggle():this._render()},t.prototype.pauseAudio=function(){this._scene.audioEnabled===!0&&(this._scene.audioEnabled=!1)},t.prototype.resumeAudio=function(){this._scene.audioEnabled===!1&&(this._scene.audioEnabled=!0)},t.prototype.toggleDebug=function(n,t,i){void 0===n&&(n=!1);void 0===t&&(t=0);void 0===i&&(i=null);this._scene.debugLayer.isVisible()?this._scene.debugLayer.hide():this._scene.debugLayer.show({popup:n,initialTab:t,parentElement:i})},t.prototype.getGuiMode=function(){return this._gui},t.prototype.getGuiElement=function(){return document.getElementById("gui")},t.prototype.getSceneMarkup=function(){return this._markup},t.prototype.drawSceneMarkup=function(t){var r,i;"Html"===this._gui?(r=document.getElementById("gui"),null==r?(i=document.createElement("div"),i.id="gui",i.style.width="100%",i.style.height="100%",i.style.opacity="1",i.style.zIndex="10",i.style.outline="none",i.style.backgroundColor="transparent",document.body.appendChild(i),i.innerHTML=t):r.innerHTML=t):n.Tools.Warn("Scene gui markup disabled.")},t.prototype.clearSceneMarkup=function(){if("Html"===this._gui){var t=document.getElementById("gui");null!=t&&(t.innerHTML="")}else n.Tools.Warn("Scene gui markup disabled.")},t.prototype.rayCast=function(n,t,i){return this._scene.pickWithRay(n,t,i)},t.prototype.multiRayCast=function(n,t){return this._scene.multiPickWithRay(n,t)},t.prototype.getMaterialInstance=function(n,t){void 0===t&&(t=null);var i=this._scene.getMaterialByName(n);return null==i&&null!=t&&(i=t(n)),null!=i?i:null},t.prototype.hasPrefabMesh=function(t){var i="Prefab."+t;return null!=n.SceneManager.prefabs[i]},t.prototype.getPrefabMesh=function(t){var i=null,r="Prefab."+t;return this.hasPrefabMesh(t)&&(i=n.SceneManager.prefabs[r]),i},t.prototype.instantiatePrefab=function(t,i,r,u,f,e){var v=this,o,h,a,c,l,s;return void 0===r&&(r=null),void 0===u&&(u=null),void 0===f&&(f=null),void 0===e&&(e=null),o=null,h="Prefab."+t,this.hasPrefabMesh(t)?(a=this.getPrefabMesh(t),null!=a?(o=a.clone(i,e,!1,!1),null!=o)?(o.name=n.Utilities.ReplaceAll(o.name,"Prefab.",""),o.parent!==e&&(o.parent=e),null!=r&&(o.position=r),null!=u&&(o.rotation=u),null!=f&&(o.scaling=f),c=[o],l=o.getChildMeshes(!1),null!=l&&l.length>0&&l.forEach(function(t){t.name=n.Utilities.ReplaceAll(t.name,"Prefab.","");c.push(t)}),c.forEach(function(n){var t,u,e;if(null!=n.source&&(t=n,null==n.skeleton&&null!=n.source.skeleton&&(u=n.source.skeleton.name+".Skeleton",e=u+"."+n.source.skeleton.id,n.skeleton=n.source.skeleton.clone(u,e)),(null==t._LODLevels||t._LODLevels.length<=0)&&null!=t.source&&null!=t.source._LODLevels&&t.source._LODLevels.length>0)){for(var o=t.source._LODLevels,h=o.length,i=0,r=[],i=0;i<h;i++){var s=o[i],f=s.mesh,c=null!=f?f.clone(f.name.replace("Prefab.",""),n,!1,!1):null;r.push({distance:s.distance,mesh:c})}null!=r&&r.length>0&&r.forEach(function(t){n.addLODLevel(t.distance,t.mesh)})}}),s=[],c.forEach(function(t){var f,i;if(null!=t.metadata&&t.metadata.tagName&&null!=t.metadata.tagName&&"[INSTANCE]"===t.metadata.tagName)if(t.metadata.properties&&null!=t.metadata.properties&&t.metadata.properties.prefabSource&&null!=t.metadata.properties.prefabSource&&""!==t.metadata.properties.prefabSource){var e=t.metadata.properties.prefabSource,o=t.metadata.properties.prefabOffset,r=t.metadata.properties.prefabPosition,u=v._scene.getMeshByID(e);null!=u?(f=t.name,i=u.createInstance(f),null!=i?(i.parent=t.parent,null!=u.metadata&&(i.metadata=n.SceneManager.CloneMetadata(u.metadata)),o===!0&&null!=r&&r.length>=3&&(i.position=new n.Vector3(r[0],r[1],r[2])),s.push(i),v.safeDestroy(t)):n.Tools.Warn("===> Failed to create instance: "+f)):n.Tools.Warn("===> Failed to locate prefab source: "+e)}else n.Tools.Warn("===> Failed to parse prefab metadata: "+t.name);else s.push(t)}),null!=s&&s.length>0&&n.SceneManager.parseMeshMetadata(s,this._scene)):n.Tools.Warn("Failed to create prefab of: "+h):n.Tools.Warn("Failed to lookup prefab map: "+h)):n.Tools.Warn("Unable to locate prefab master: "+h),o},t.prototype.tween=function(t,i,r,u,f,e,o,s,h,c,l){void 0===e&&(e=30);void 0===o&&(o=null);void 0===s&&(s=1);void 0===h&&(h=null);void 0===c&&(c=n.Animation.ANIMATIONLOOPMODE_RELATIVE);void 0===l&&(l=!1);var a="Tween_"+this.time.toString();return n.Animation.CreateAndStartAnimation(a,t,i,e,f,r,u,c,o,h)},t.prototype.tweenKeys=function(t,i,r,u,f,e,o,s,h,c,l){void 0===f&&(f=30);void 0===e&&(e=null);void 0===o&&(o=1);void 0===s&&(s=null);void 0===h&&(h=n.Animation.ANIMATIONTYPE_VECTOR3);void 0===c&&(c=n.Animation.ANIMATIONLOOPMODE_RELATIVE);void 0===l&&(l=!1);var v=null!=f&&f>0?f:30,y="Tween_"+this.time.toString(),a=new n.Animation(y,i,v,h,c,l);return null!=e&&a.setEasingFunction(e),a.setKeys(r),this._scene.beginDirectAnimation(t,[a],0,u,c==n.Animation.ANIMATIONLOOPMODE_RELATIVE,o,s)},t.prototype.tweenFloat=function(t,i,r,u,f,e,o,s,h,c,l){void 0===e&&(e=30);void 0===o&&(o=null);void 0===s&&(s=1);void 0===h&&(h=null);void 0===c&&(c=n.Animation.ANIMATIONLOOPMODE_RELATIVE);void 0===l&&(l=!1);var v=null!=e&&e>0?e:30,y=[{frame:0,value:r},{frame:f,value:u}],p="Tween_"+this.time.toString(),w=n.Animation.ANIMATIONTYPE_FLOAT,a=new n.Animation(p,i,v,w,c,l);return null!=o&&a.setEasingFunction(o),a.setKeys(y),this._scene.beginDirectAnimation(t,[a],0,f,c==n.Animation.ANIMATIONLOOPMODE_RELATIVE,s,h)},t.prototype.playAnimationClip=function(n,t,i,r,u,f){var l,p,k,d;void 0===i&&(i=0);void 0===r&&(r=0);void 0===u&&(u=!0);void 0===f&&(f=null);var o=null,a=r>0?r:1,e=-1,s=-1,v=0,y=!1,w=!1,g=null,h=this.findSceneAnimationClip(n,t);if((null!=h&&(w=!0,g=f,e===-1&&(e=h.start,s=h.stop,v=h.behavior,y=h.behavior<2,a=r>0?r:h.playback)),u)&&(l=t.getChildMeshes(!1),null!=l&&l.length>0))for(p=0;p<l.length;p++){var b=l[p],nt=null,c=this.findSceneAnimationClip(n,b);null!=c&&(w===!1&&(w=!0,nt=f),e===-1&&(e=c.start,s=c.stop,v=c.behavior,y=c.behavior<2,a=r>0?r:c.playback),e>=0&&s>=0)&&(this.setupAnimationProperties(b,v,i),k=this._scene.beginAnimation(b,e,s,y,a,nt),null!=k&&(null==o&&(o=[]),o.push(k)))}return e>=0&&s>=0&&(this.setupAnimationProperties(t,v,i),d=this._scene.beginAnimation(t,e,s,y,a,g),null!=d&&(null==o&&(o=[]),o.push(d))),o},t.prototype.setupAnimationProperties=function(t,i,r){if(null!=t&&(null!=t.animations&&t.animations.length>0&&n.SceneManager.SetAnimationLooping(t,i),t instanceof n.AbstractMesh)){var u=t;null!=u.skeleton&&null!=u.skeleton.bones&&u.skeleton.bones.length>0&&n.SceneManager.SetSkeletonProperties(u.skeleton,i,r)}},t.prototype.applyForce=function(t,i,r){null!=t&&(null!=t.physicsImpostor?null!=i&&t.physicsImpostor.applyForce(i,r):n.Tools.Warn("Physics imposter not defined for mesh: "+t.name))},t.prototype.applyImpulse=function(t,i,r){null!=t&&(null!=t.physicsImpostor?null!=i&&t.physicsImpostor.applyImpulse(i,r):n.Tools.Warn("Physics imposter not defined for mesh: "+t.name))},t.prototype.applyFriction=function(t,i){null!=t&&(null!=t.physicsImpostor&&null!=t.physicsImpostor.physicsBody&&null!=t.physicsImpostor.physicsBody.material?t.physicsImpostor.physicsBody.material.friction=i:n.Tools.Warn("Physics imposter not defined for mesh: "+t.name))},t.prototype.getFrictionLevel=function(t){var i=0;return null!=t&&(null!=t.physicsImpostor&&null!=t.physicsImpostor.physicsBody&&null!=t.physicsImpostor.physicsBody.material?i=t.physicsImpostor.physicsBody.material.friction:n.Tools.Warn("Physics imposter not defined for mesh: "+t.name)),i},t.prototype.getLinearVelocity=function(t){var i=null;return null!=t&&(null!=t.physicsImpostor?i=t.physicsImpostor.getLinearVelocity():n.Tools.Warn("Physics imposter not defined for mesh: "+t.name)),i},t.prototype.setLinearVelocity=function(t,i){null!=t&&(null!=t.physicsImpostor?null!=i&&t.physicsImpostor.setLinearVelocity(i):n.Tools.Warn("Physics imposter not defined for mesh: "+t.name))},t.prototype.getAngularVelocity=function(t){var i=null;return null!=t&&(null!=t.physicsImpostor?i=t.physicsImpostor.getAngularVelocity():n.Tools.Warn("Physics imposter not defined for mesh: "+t.name)),i},t.prototype.setAngularVelocity=function(t,i){null!=t&&(null!=t.physicsImpostor?null!=i&&t.physicsImpostor.setAngularVelocity(i):n.Tools.Warn("Physics imposter not defined for mesh: "+t.name))},t.prototype.checkCollisionContact=function(t,i,r,u){void 0===u&&(u=.5);var f=!1;return null!=t&&(null!=t.physicsImpostor?f=!0:n.Tools.Warn("Physics imposter not defined for mesh: "+t.name)),f},t.prototype.moveWithCollisions=function(t,i,r){void 0===r&&(r=0);null!=t&&(0!=r&&t.rotate(n.Axis.Y,r),null!=i&&t.moveWithCollisions(i))},t.prototype.moveWithTranslation=function(t,i,r){void 0===r&&(r=0);null!=t&&(0!=r&&t.rotate(n.Axis.Y,r),null!=i&&t.position.addInPlace(i))},t.prototype.addSceneComponent=function(t,i,r,u){var e,f,o,s;if(void 0===r&&(r=!0),void 0===u&&(u={}),e=null,null==i)throw new Error("Null owner scene obejct specified.");if(null==t||""===t)throw new Error("Null scene obejct klass specified.");return null!=i.metadata&&i.metadata.api||(f={api:!0,type:"Babylon",prefab:!1,state:{},objectName:"Scene Component",objectId:"0",tagName:"Untagged",layerIndex:0,layerName:"Default",areaIndex:-1,navAgent:null,meshLink:null,meshObstacle:null,socketList:[],animationClips:[],animationEvents:[],collisionEvent:null,components:[],properties:{}},i.metadata=f),null!=i.metadata&&i.metadata.api?(null!=i.metadata.disposal&&i.metadata.disposal!==!1||(i.onDispose=function(){n.SceneManager.DestroyComponents(i)},i.metadata.disposal=!0),f=i.metadata,(null==f.components&&(f.components=[]),null!=f.components)?(o=n.Tools.Instantiate(t),null!=o?(e=new o(i,this._scene,r,u),null!=e)?(s={order:1e3,name:"EditorScriptComponent",klass:t,update:r,properties:u,instance:e,tag:{}},f.components.push(s),e.register()):n.Tools.Error("Failed to create component instance"):n.Tools.Error("Failed to create component class")):n.Tools.Error("Failed to parse metadata components")):n.Tools.Error("Null owner object metadata"),e},t.prototype.findSceneComponent=function(n,t){var f=null,i,r,u;if(null==t)throw new Error("Null owner scene obejct specified.");if(null!=t.metadata&&t.metadata.api&&(i=t.metadata,null!=i.components&&i.components.length>0))for(r=0;r<i.components.length;r++)if(u=i.components[r],null!=u.instance&&u.klass===n){f=u.instance;break}return null!=f?f:null},t.prototype.findSceneComponents=function(n,t){var f=null,i,r,u;if(null==t)throw new Error("Null owner scene obejct specified.");if(null!=t.metadata&&t.metadata.api&&(i=t.metadata,null!=i.components&&i.components.length>0))for(r=0;r<i.components.length;r++)u=i.components[r],null!=u.instance&&u.klass===n&&f.push(u.instance);return null!=f?f:null},t.prototype.findSceneMetadata=function(t){var i=null,r;return null!=t.metadata&&t.metadata.api&&(r=t.metadata,i=new n.ObjectMetadata(r)),i},t.prototype.findSceneChildMesh=function(t,i,r,u,f){void 0===r&&(r=n.SearchType.StartsWith);void 0===u&&(u=!0);void 0===f&&(f=null);var e=(null!=r?r:n.SearchType.StartsWith,i.getChildMeshes(u,f));return n.SceneManager.FindMesh(t,e,r)},t.prototype.findSceneCollisionMesh=function(n,t,i){var r,u,e,f;if(void 0===t&&(t=!0),void 0===i&&(i=null),r=null,u=n.getChildMeshes(t,i),null!=u&&u.length>0)for(e=0;e<u.length;e++)if(f=u[e],"Collider"===f.name||f.name.indexOf("_Collider")>=0||f.name.indexOf(":Collider")>=0){r=f;break}return null==r&&(r=n),r},t.prototype.findSceneSkeleton=function(n){var r=null,u=null!=this._scene.skeletons?this._scene.skeletons.length:0,t,i,f;if(u>0)for(t=0,t=0;t<u;t++)if(i=this._scene.skeletons[t],f=""+i.id,f===n){r=i;break}return r},t.prototype.findSceneSocketMesh=function(t,i,r,u){var f,e,o,s;if(void 0===r&&(r=!0),void 0===u&&(u=null),f=n.SceneManager.locateOwnerSocketMesh(t,i),null==f&&(e=i.getChildMeshes(r,u),null!=e&&e.length>0))for(o=0;o<e.length;o++)if(s=e[o],f=n.SceneManager.locateOwnerSocketMesh(t,s),null!=f)break;return f},t.prototype.findSceneSocketMeshes=function(t,i,r){var u,f,e,o;if(void 0===i&&(i=!0),void 0===r&&(r=null),u=n.SceneManager.locateOwnerSocketMeshes(t),null==u&&(f=t.getChildMeshes(i,r),null!=f&&f.length>0))for(e=0;e<f.length;e++)if(o=f[e],u=n.SceneManager.locateOwnerSocketMeshes(o),null!=u)break;return u},t.prototype.findSceneAnimationClip=function(n,t){var u=null,i,r;if(null!=t&&null!=t.metadata&&t.metadata.api&&(i=t.metadata,null!=i.animationClips&&i.animationClips.length>0))if(null!=n&&""!==n){for(r=0,r=0;r<i.animationClips.length;r++)if(i.animationClips[r].name===n){u=i.animationClips[r];break}}else u=i.animationClips[0];return u},t.prototype.findSceneAnimationClips=function(n){var i=null,t;return null!=n&&null!=n.metadata&&n.metadata.api&&(t=n.metadata,null!=t.animationClips&&t.animationClips.length>0&&(i=t.animationClips)),i},t.prototype.findSceneParticleSystem=function(n,t){var u=null,f,i,r;if(null==t)throw new Error("Null owner scene obejct specified.");if(null!=this._scene.particleSystems&&this._scene.particleSystems.length>0)for(f=this._scene.particleSystems.length,i=0;i<f;i++)if(r=this._scene.particleSystems[i],r.emitter===t&&r.name===n){u=r;break}return u},t.prototype.findSceneParticleSystems=function(n){var t=[];if(null==n)throw new Error("Null owner scene obejct specified.");return null!=this._scene.particleSystems&&this._scene.particleSystems.length>0&&this._scene.particleSystems.forEach(function(i){i.emitter===n&&t.push(i)}),t},t.prototype.findSceneLensFlareSystem=function(n,t){var u=null,f,i,r;if(null==t)throw new Error("Null owner scene obejct specified.");if(null!=this._scene.lensFlareSystems&&this._scene.lensFlareSystems.length>0)for(f=this._scene.lensFlareSystems.length,i=0;i<f;i++)if(r=this._scene.lensFlareSystems[i],r.getEmitter()===t&&r.name===n){u=r;break}return u},t.prototype.findSceneLensFlareSystems=function(n){var t=[];if(null==n)throw new Error("Null owner scene obejct specified.");return null!=this._scene.lensFlareSystems&&this._scene.lensFlareSystems.length>0&&this._scene.lensFlareSystems.forEach(function(i){i.getEmitter()===n&&t.push(i)}),t},t.prototype.resetUserInput=function(){n.SceneManager.keymap={};n.SceneManager.wheel=0;n.SceneManager.clientx=0;n.SceneManager.clienty=0;n.SceneManager.mousex=0;n.SceneManager.mousey=0;n.SceneManager.vertical=0;n.SceneManager.horizontal=0;n.SceneManager.x_wheel=0;n.SceneManager.x_mousex=0;n.SceneManager.x_mousey=0;n.SceneManager.x_vertical=0;n.SceneManager.x_horizontal=0;n.SceneManager.k_mousex=0;n.SceneManager.k_mousey=0;n.SceneManager.k_vertical=0;n.SceneManager.k_horizontal=0;n.SceneManager.j_mousex=0;n.SceneManager.j_mousey=0;n.SceneManager.j_vertical=0;n.SceneManager.j_horizontal=0;n.SceneManager.g_mousex=0;n.SceneManager.g_mousey=0;n.SceneManager.g_vertical=0;n.SceneManager.g_horizontal=0;n.SceneManager.preventDefault=!1;n.SceneManager.gamepadButtonUp=[];n.SceneManager.gamepadButtonDown=[];n.SceneManager.gamepadButtonPress=[];n.SceneManager.gamepadDpadUp=[];n.SceneManager.gamepadDpadDown=[];n.SceneManager.gamepadDpadPress=[];n.SceneManager.gamepadLeftTrigger=[];n.SceneManager.gamepadRightTrigger=[];n.SceneManager.mouseButtonUp=[];n.SceneManager.mouseButtonDown=[];n.SceneManager.mouseButtonPress=[];n.SceneManager.keyButtonUp=[];n.SceneManager.keyButtonDown=[];n.SceneManager.keyButtonPress=[]},t.prototype.enableUserInput=function(t){void 0===t&&(t=null);var r=!(null==t||!t.preventDefault)&&t.preventDefault,i=!(null==t||!t.useCapture)&&t.useCapture,u=!(null==t||!t.enableVirtualJoystick)&&t.enableVirtualJoystick,f=!(null==t||!t.disableRightStick)&&t.disableRightStick,e=null!=t&&t.gamepadConnected?t.gamepadConnected:null;this._input||(this.resetUserInput(),document.documentElement.tabIndex=1,document.documentElement.addEventListener("keyup",n.SceneManager.inputKeyUpHandler,i),document.documentElement.addEventListener("keydown",n.SceneManager.inputKeyDownHandler,i),document.documentElement.addEventListener("pointerup",n.SceneManager.inputPointerUpHandler,i),document.documentElement.addEventListener("pointerdown",n.SceneManager.inputPointerDownHandler,i),document.documentElement.addEventListener("pointermove",n.SceneManager.inputPointerMoveHandler,i),document.documentElement.addEventListener("onwheel"in document?"wheel":"mousewheel",n.SceneManager.inputPointerWheelHandler,i),n.SceneManager.preventDefault=r,null==n.SceneManager.gamepadManager&&(n.SceneManager.gamepadConnected=e,n.SceneManager.gamepadManager=new n.GamepadManager,n.SceneManager.gamepadManager.onGamepadConnectedObservable.add(n.SceneManager.inputGamepadConnected)),n.SceneManager.virtualJoystick===!1&&(n.SceneManager.virtualJoystick=u,n.SceneManager.virtualJoystick===!0&&(null==n.SceneManager.leftJoystick&&(n.SceneManager.leftJoystick=new n.VirtualJoystick(!0),n.SceneManager.leftJoystick.setJoystickSensibility(5*n.UserInputOptions.JoystickLeftSensibility)),f===!1&&null==n.SceneManager.rightJoystick&&(n.SceneManager.rightJoystick=new n.VirtualJoystick(!1),n.SceneManager.rightJoystick.reverseUpDown=!0,n.SceneManager.rightJoystick.setJoystickSensibility(5*n.UserInputOptions.JoystickRightSensibility),n.SceneManager.rightJoystick.setJoystickColor(n.UserInputOptions.JoystickRightHandleColor)))),this._input=!0,document.documentElement.focus())},t.prototype.disableUserInput=function(t){void 0===t&&(t=!1);this._input&&(document.documentElement.removeEventListener("keyup",n.SceneManager.inputKeyUpHandler,t),document.documentElement.removeEventListener("keydown",n.SceneManager.inputKeyDownHandler,t),document.documentElement.removeEventListener("pointerup",n.SceneManager.inputPointerUpHandler,t),document.documentElement.removeEventListener("pointerdown",n.SceneManager.inputPointerDownHandler,t),document.documentElement.removeEventListener("pointermove",n.SceneManager.inputPointerMoveHandler,t),document.documentElement.removeEventListener("onwheel"in document?"wheel":"mousewheel",n.SceneManager.inputPointerWheelHandler,t),n.SceneManager.preventDefault=!1,this.resetUserInput(),this._input=!1)},t.prototype.getUserInput=function(t){var i=0;if(this._input)switch(t){case n.UserInputAxis.Vertical:case n.UserInputAxis.Horizontal:i=t===n.UserInputAxis.Horizontal?n.SceneManager.horizontal:n.SceneManager.vertical;break;case n.UserInputAxis.MouseX:case n.UserInputAxis.MouseY:i=t===n.UserInputAxis.MouseX?n.SceneManager.mousex:n.SceneManager.mousey;break;case n.UserInputAxis.ClientX:case n.UserInputAxis.ClientY:i=t===n.UserInputAxis.ClientX?n.SceneManager.clientx:n.SceneManager.clienty;break;case n.UserInputAxis.Wheel:i=n.SceneManager.wheel}return i},t.prototype.onKeyUp=function(t){this._input&&n.SceneManager.keyButtonUp.push(t)},t.prototype.onKeyDown=function(t){this._input&&n.SceneManager.keyButtonDown.push(t)},t.prototype.onKeyPress=function(t,i){this._input&&n.SceneManager.keyButtonPress.push({index:t,action:i})},t.prototype.getKeyInput=function(t){var r=!1,i;return this._input&&(i="k"+t.toString(),null!=n.SceneManager.keymap[i]&&(r=n.SceneManager.keymap[i])),r},t.prototype.onPointerUp=function(t){this._input&&n.SceneManager.mouseButtonUp.push(t)},t.prototype.onPointerDown=function(t){this._input&&n.SceneManager.mouseButtonDown.push(t)},t.prototype.onPointerPress=function(t,i){this._input&&n.SceneManager.mouseButtonPress.push({index:t,action:i})},t.prototype.getPointerInput=function(t){var r=!1,i;return this._input&&(i="p"+t.toString(),null!=n.SceneManager.keymap[i]&&(r=n.SceneManager.keymap[i])),r},t.prototype.onButtonUp=function(t){this._input&&n.SceneManager.gamepadButtonUp.push(t)},t.prototype.onButtonDown=function(t){this._input&&n.SceneManager.gamepadButtonDown.push(t)},t.prototype.onButtonPress=function(t,i){this._input&&n.SceneManager.gamepadButtonPress.push({index:t,action:i})},t.prototype.getButtonInput=function(t){var r=!1,i;return this._input&&(i="b"+t.toString(),null!=n.SceneManager.keymap[i]&&(r=n.SceneManager.keymap[i])),r},t.prototype.onDpadUp=function(t){this._input&&n.SceneManager.gamepadDpadUp.push(t)},t.prototype.onDpadDown=function(t){this._input&&n.SceneManager.gamepadDpadDown.push(t)},t.prototype.onDpadPress=function(t,i){this._input&&n.SceneManager.gamepadDpadPress.push({index:t,action:i})},t.prototype.getDpadInput=function(t){var r=!1,i;return this._input&&(i="d"+t.toString(),null!=n.SceneManager.keymap[i]&&(r=n.SceneManager.keymap[i])),r},t.prototype.onTriggerLeft=function(t){this._input&&n.SceneManager.gamepadLeftTrigger.push(t)},t.prototype.onTriggerRight=function(t){this._input&&n.SceneManager.gamepadRightTrigger.push(t)},t.prototype.getTriggerInput=function(t){var r=0,i;return this._input&&(i="t"+t.toString(),null!=n.SceneManager.keymap[i]&&(r=n.SceneManager.keymap[i])),r},t.prototype.getConnectedGamepad=function(){return this._input?n.SceneManager.gamepad:null},t.prototype.getConnectedGamepadType=function(){return this._input?n.SceneManager.gamepadType:n.GamepadType.None},t.prototype.getLeftJoystick=function(){return this._input?n.SceneManager.leftJoystick:null},t.prototype.getRightJoystick=function(){return this._input?n.SceneManager.rightJoystick:null},t.prototype.getJoystickPress=function(t){var i=!1;return this._input&&(t===n.JoystickButton.Left&&null!=n.SceneManager.leftJoystick&&n.SceneManager.leftJoystick.pressed===!0?i=!0:t===n.JoystickButton.Right&&null!=n.SceneManager.rightJoystick&&n.SceneManager.rightJoystick.pressed===!0&&(i=!0)),i},t.prototype.disposeVirtualJoysticks=function(){this._input&&(null!=n.SceneManager.leftJoystick&&(n.SceneManager.leftJoystick.releaseCanvas(),n.SceneManager.leftJoystick=null),null!=n.SceneManager.rightJoystick&&(n.SceneManager.rightJoystick.releaseCanvas(),n.SceneManager.rightJoystick=null),n.SceneManager.virtualJoystick=!1)},t.prototype.updateCameraPosition=function(t,i,r,u){if(null!=t){var f=t._computeLocalCameraSpeed()*u,e=n.Matrix.RotationYawPitchRoll(t.rotation.y,t.rotation.x,0),o=n.Vector3.TransformCoordinates(new n.Vector3(i*f,0,r*f),e);t.cameraDirection=t.cameraDirection.add(o)}},t.prototype.updateCameraRotation=function(t,i,r,u){null!=t&&(t.cameraRotation=t.cameraRotation.add(new n.Vector2(r*u,i*u)))},t.prototype.updateCameraUserInput=function(t,i,r){if(null!=t){var u=this.getUserInput(n.UserInputAxis.Horizontal),f=this.getUserInput(n.UserInputAxis.Vertical),e=this.getUserInput(n.UserInputAxis.MouseX),o=this.getUserInput(n.UserInputAxis.MouseY);this.updateCameraPosition(t,u,f,i);this.updateCameraRotation(t,e,o,r)}},t.prototype.enableAutoCameraUserInput=function(n,t,i){null!=n&&(this.updateCamera=n,this.cameraInputMoveSpeed=t,this.cameraInputRotateSpeed=i,this.updateCameraInput=!0)},t.prototype.clearAutoCameraUserInput=function(){this.updateCamera=null;this.cameraInputMoveSpeed=1;this.cameraInputRotateSpeed=.005;this.updateCameraInput=!1},t.prototype.autoUpdateCameraUserInput=function(){this.updateCameraUserInput(this.updateCamera,this.cameraInputMoveSpeed,this.cameraInputRotateSpeed)},t.prototype.getNavigationTool=function(){return null==this._navigation&&(this._navigation=new Navigation),this._navigation},t.prototype.getNavigationZone=function(){return"scene"},t.prototype.findNavigationPath=function(n,t){if(null==this._navigation||null==this._navmesh||null==n||null==t)return null;var i=this.getNavigationZone(),r=this._navigation.getGroup(i,n);return this._navigation.findPath(n,t,i,r)},t.prototype.hasNavigationMesh=function(){return null!=this._navmesh},t.prototype.getNavigationMesh=function(){return this._navmesh},t.prototype.buildNavigationMesh=function(t){if(null!=t){this._navmesh=t;var i=this.getNavigationTool(),r=i.buildNodes(this._navmesh);null!=r?i.setZoneData(this.getNavigationZone(),r):n.Tools.Warn("Failed to set scene navigation zone")}},t.prototype.getNavigationPoint=function(t,i,r){var e=this,f,u;return(void 0===i&&(i=2),void 0===r&&(r=Number.MAX_VALUE),null==this._navmesh||null==t)?null:(f=(new n.Vector3(t.x,t.y+i,t.z),new n.Ray(t,new n.Vector3(0,-1,0),r)),u=this._scene.pickWithRay(f,function(n){return n===e._navmesh}),u.hit&&u.pickedPoint?u.pickedPoint:null)},t.prototype.moveNavigationAgent=function(t,i,r,u,f){var h;if(i&&i.length>0){for(var o=0,s=[{frame:0,value:t.position}],e=0;e<i.length;e++)o+=n.Vector3.Distance(s[e].value,i[e]),s.push({frame:o,value:i[e]});h=new n.Animation("Move","position",3,n.Animation.ANIMATIONTYPE_VECTOR3,n.Animation.ANIMATIONLOOPMODE_RELATIVE);h.setKeys(s);t.animations.push(h);this._scene.beginAnimation(t,0,o,u,r,f)}},t.prototype.getNavigationAgents=function(){return this._scene.getMeshesByTags("[NAVAGENT]")},t.prototype.getNavigationAgentInfo=function(t){return new n.NavigationAgent(t)},t.prototype.getNavigationAreaTable=function(){return null!=this._navmesh.metadata&&null!=this._navmesh.metadata.properties&&null!=this._navmesh.metadata.properties.table?this._navmesh.metadata.properties.table:[]},t.prototype.getNavigationAreaIndexes=function(){return null!=this._navmesh.metadata&&null!=this._navmesh.metadata.properties&&null!=this._navmesh.metadata.properties.areas?this._navmesh.metadata.properties.areas:[]},t.prototype.getNavigationAreaName=function(n){var r="",t,i;if(null!=this._navmesh.metadata&&null!=this._navmesh.metadata.properties&&null!=this._navmesh.metadata.properties.table&&(t=this._navmesh.metadata.properties.table,null!=t))for(i=0;i<t.length;i++)if(t[i].index===n){r=t[i].area;break}return r},t.prototype.getNavigationAreaCost=function(n){var r=-1,t,i;if(null!=this._navmesh.metadata&&null!=this._navmesh.metadata.properties&&(t=this._navmesh.metadata.properties.table,null!=t))for(i=0;i<t.length;i++)if(t[i].index===n){r=t[i].cost;break}return r},t.inputKeyDownHandler=function(t){var i="k"+t.keyCode.toString(),r=!1;switch(null!=n.SceneManager.keymap[i]&&(r=n.SceneManager.keymap[i]),n.SceneManager.keymap[i]=!0,t.keyCode){case 39:case 68:n.SceneManager.k_horizontal=1;break;case 37:case 65:n.SceneManager.k_horizontal=-1;break;case 38:case 87:n.SceneManager.k_vertical=1;break;case 40:case 83:n.SceneManager.k_vertical=-1}return null!=n.SceneManager.keyButtonDown&&n.SceneManager.keyButtonDown.length>0&&n.SceneManager.keyButtonDown.forEach(function(n){n(t.keyCode)}),r||null!=n.SceneManager.keyButtonPress&&n.SceneManager.keyButtonPress.length>0&&n.SceneManager.keyButtonPress.forEach(function(n){n.index===t.keyCode&&n.action()}),n.SceneManager.preventDefault&&t.preventDefault(),!0},t.inputKeyUpHandler=function(t){var i="k"+t.keyCode.toString();switch(n.SceneManager.keymap[i]=!1,t.keyCode){case 39:case 37:case 68:case 65:n.SceneManager.k_horizontal=0;break;case 38:case 40:case 87:case 83:n.SceneManager.k_vertical=0}return null!=n.SceneManager.keyButtonUp&&n.SceneManager.keyButtonUp.length>0&&n.SceneManager.keyButtonUp.forEach(function(n){n(t.keyCode)}),n.SceneManager.preventDefault&&t.preventDefault(),!0},t.inputPointerWheelHandler=function(t){var i=t.deltaY?-t.deltaY:t.wheelDelta/40;return n.SceneManager.x_wheel=Math.abs(i)>n.UserInputOptions.PointerWheelDeadZone?0+i:0,n.SceneManager.preventDefault&&t.preventDefault(),!0},t.inputPointerDownHandler=function(t){0===t.button&&(n.SceneManager.previousPosition={x:t.clientX,y:t.clientY});var i="p"+t.button.toString(),r=!1;return null!=n.SceneManager.keymap[i]&&(r=n.SceneManager.keymap[i]),n.SceneManager.keymap[i]=!0,null!=n.SceneManager.mouseButtonDown&&n.SceneManager.mouseButtonDown.length>0&&n.SceneManager.mouseButtonDown.forEach(function(n){n(t.button)}),r||null!=n.SceneManager.mouseButtonPress&&n.SceneManager.mouseButtonPress.length>0&&n.SceneManager.mouseButtonPress.forEach(function(n){n.index===t.button&&n.action()}),n.SceneManager.preventDefault&&t.preventDefault(),!0},t.inputPointerUpHandler=function(t){0===t.button&&null!=n.SceneManager.previousPosition&&(n.SceneManager.previousPosition=null,n.SceneManager.k_mousex=0,n.SceneManager.k_mousey=0);var i="p"+t.button.toString();return n.SceneManager.keymap[i]=!1,null!=n.SceneManager.mouseButtonUp&&n.SceneManager.mouseButtonUp.length>0&&n.SceneManager.mouseButtonUp.forEach(function(n){n(t.button)}),n.SceneManager.preventDefault&&t.preventDefault(),!0},t.inputPointerMoveHandler=function(t){var u,f,r,i;return n.SceneManager.virtualJoystick===!1&&null!=n.SceneManager.previousPosition&&(n.SceneManager.clientx=t.clientX,n.SceneManager.clienty=t.clientY,u=t.clientX-n.SceneManager.previousPosition.x,f=t.clientY-n.SceneManager.previousPosition.y,n.SceneManager.previousPosition={x:t.clientX,y:t.clientY},r=u*(n.UserInputOptions.PointerAngularSensibility/10),i=f*(n.UserInputOptions.PointerAngularSensibility/10),0!=r&&(n.SceneManager.k_mousex=r),0!=i&&(n.SceneManager.k_mousey=n.SceneManager.rightHanded?-i:i)),n.SceneManager.preventDefault&&t.preventDefault(),!0},t.inputButtonDownHandler=function(t){if(null!=n.SceneManager.gamepad){var i="b"+t.toString(),r=!1;null!=n.SceneManager.keymap[i]&&(r=n.SceneManager.keymap[i]);n.SceneManager.keymap[i]=!0;null!=n.SceneManager.gamepadButtonDown&&n.SceneManager.gamepadButtonDown.length>0&&n.SceneManager.gamepadButtonDown.forEach(function(n){n(t)});r||null!=n.SceneManager.gamepadButtonPress&&n.SceneManager.gamepadButtonPress.length>0&&n.SceneManager.gamepadButtonPress.forEach(function(n){n.index===t&&n.action()})}},t.inputButtonUpHandler=function(t){if(null!=n.SceneManager.gamepad){var i="b"+t.toString();n.SceneManager.keymap[i]=!1;null!=n.SceneManager.gamepadButtonUp&&n.SceneManager.gamepadButtonUp.length>0&&n.SceneManager.gamepadButtonUp.forEach(function(n){n(t)})}},t.inputXboxDPadDownHandler=function(t){if(null!=n.SceneManager.gamepad){var i="d"+t.toString(),r=!1;null!=n.SceneManager.keymap[i]&&(r=n.SceneManager.keymap[i]);n.SceneManager.keymap[i]=!0;null!=n.SceneManager.gamepadDpadDown&&n.SceneManager.gamepadDpadDown.length>0&&n.SceneManager.gamepadDpadDown.forEach(function(n){n(t)});r||null!=n.SceneManager.gamepadDpadPress&&n.SceneManager.gamepadDpadPress.length>0&&n.SceneManager.gamepadDpadPress.forEach(function(n){n.index===t&&n.action()})}},t.inputXboxDPadUpHandler=function(t){if(null!=n.SceneManager.gamepad){var i="d"+t.toString();n.SceneManager.keymap[i]=!1;null!=n.SceneManager.gamepadDpadUp&&n.SceneManager.gamepadDpadUp.length>0&&n.SceneManager.gamepadDpadUp.forEach(function(n){n(t)})}},t.inputXboxLeftTriggerHandler=function(t){null!=n.SceneManager.gamepad&&(n.SceneManager.keymap.t0=t,null!=n.SceneManager.gamepadLeftTrigger&&n.SceneManager.gamepadLeftTrigger.length>0&&n.SceneManager.gamepadLeftTrigger.forEach(function(n){n(t)}))},t.inputXboxRightTriggerHandler=function(t){null!=n.SceneManager.gamepad&&(n.SceneManager.keymap.t1=t,null!=n.SceneManager.gamepadRightTrigger&&n.SceneManager.gamepadRightTrigger.length>0&&n.SceneManager.gamepadRightTrigger.forEach(function(n){n(t)}))},t.inputLeftStickHandler=function(t){if(null!=n.SceneManager.gamepad){var i=t,r=i.x*n.UserInputOptions.GamepadLStickSensibility,u=i.y*n.UserInputOptions.GamepadLStickSensibility;i.x=Math.abs(r)>n.UserInputOptions.GamepadDeadStickValue?0+r:0;i.y=Math.abs(u)>n.UserInputOptions.GamepadDeadStickValue?0+u:0;n.SceneManager.g_horizontal=n.UserInputOptions.GamepadLStickXInverted?-i.x:i.x;n.SceneManager.g_vertical=n.UserInputOptions.GamepadLStickYInverted?i.y:-i.y}},t.inputRightStickHandler=function(t){if(null!=n.SceneManager.gamepad){var i=t,r=i.x*n.UserInputOptions.GamepadRStickSensibility,u=i.y*n.UserInputOptions.GamepadRStickSensibility;i.x=Math.abs(r)>n.UserInputOptions.GamepadDeadStickValue?0+r:0;i.y=Math.abs(u)>n.UserInputOptions.GamepadDeadStickValue?0+u:0;n.SceneManager.g_mousex=n.UserInputOptions.GamepadRStickXInverted?-i.x:i.x;n.SceneManager.g_mousey=n.UserInputOptions.GamepadRStickYInverted?-i.y:i.y}},t.inputGamepadConnected=function(t){var i,r;null!=t&&0===t.index&&null==n.SceneManager.gamepad&&((n.SceneManager.gamepad=t,n.Tools.Log("Gamepad Connected: "+n.SceneManager.gamepad.id),n.SceneManager.gamepad.id.search("Xbox 360")!==-1||n.SceneManager.gamepad.id.search("Xbox One")!==-1||n.SceneManager.gamepad.id.search("xinput")!==-1)?(n.SceneManager.gamepadType=n.GamepadType.Xbox360,i=n.SceneManager.gamepad,i.onbuttonup(n.SceneManager.inputButtonUpHandler),i.onbuttondown(n.SceneManager.inputButtonDownHandler),i.onleftstickchanged(n.SceneManager.inputLeftStickHandler),i.onrightstickchanged(n.SceneManager.inputRightStickHandler),i.ondpadup(n.SceneManager.inputXboxDPadUpHandler),i.ondpaddown(n.SceneManager.inputXboxDPadDownHandler),i.onlefttriggerchanged(n.SceneManager.inputXboxLeftTriggerHandler),i.onrighttriggerchanged(n.SceneManager.inputXboxRightTriggerHandler)):(n.SceneManager.gamepadType=n.GamepadType.Generic,r=n.SceneManager.gamepad,r.onbuttonup(n.SceneManager.inputButtonUpHandler),r.onbuttondown(n.SceneManager.inputButtonDownHandler),r.onleftstickchanged(n.SceneManager.inputLeftStickHandler),r.onrightstickchanged(n.SceneManager.inputRightStickHandler)),null!=n.SceneManager.gamepadConnected&&n.SceneManager.gamepadConnected(n.SceneManager.gamepad,n.SceneManager.gamepadType))},t.inputVirtualJoysticks=function(){var t,r,u,i,f,e;null!=n.SceneManager.leftJoystick&&(t=n.SceneManager.leftJoystick.deltaPosition,n.SceneManager.leftJoystick.pressed||(t=t.scale(.9)),r=t.x,u=t.y,t.x=Math.abs(r)>n.UserInputOptions.JoystickDeadStickValue?0+r:0,t.y=Math.abs(u)>n.UserInputOptions.JoystickDeadStickValue?0+u:0,n.SceneManager.j_horizontal=t.x,n.SceneManager.j_vertical=t.y);null!=n.SceneManager.rightJoystick&&(i=n.SceneManager.rightJoystick.deltaPosition,n.SceneManager.rightJoystick.pressed||(i=i.scale(.9)),f=i.x,e=i.y,i.x=Math.abs(f)>n.UserInputOptions.JoystickDeadStickValue?0+f:0,i.y=Math.abs(e)>n.UserInputOptions.JoystickDeadStickValue?0+e:0,n.SceneManager.j_mousex=i.x,n.SceneManager.j_mousey=i.y)},t.updateUserInput=function(){n.SceneManager.inputVirtualJoysticks();n.SceneManager.x_horizontal=0;n.SceneManager.x_vertical=0;n.SceneManager.x_mousex=0;n.SceneManager.x_mousey=0;0!==n.SceneManager.j_horizontal?n.SceneManager.x_horizontal=n.SceneManager.j_horizontal:0!==n.SceneManager.k_horizontal?n.SceneManager.x_horizontal=n.SceneManager.k_horizontal:0!==n.SceneManager.g_horizontal&&(n.SceneManager.x_horizontal=n.SceneManager.g_horizontal);0!==n.SceneManager.j_vertical?n.SceneManager.x_vertical=n.SceneManager.j_vertical:0!==n.SceneManager.k_vertical?n.SceneManager.x_vertical=n.SceneManager.k_vertical:0!==n.SceneManager.g_vertical&&(n.SceneManager.x_vertical=n.SceneManager.g_vertical);0!==n.SceneManager.j_mousex?n.SceneManager.x_mousex=n.SceneManager.j_mousex:0!==n.SceneManager.k_mousex?n.SceneManager.x_mousex=n.SceneManager.k_mousex:0!==n.SceneManager.g_mousex&&(n.SceneManager.x_mousex=n.SceneManager.g_mousex);0!==n.SceneManager.j_mousey?n.SceneManager.x_mousey=n.SceneManager.j_mousey:0!==n.SceneManager.k_mousey?n.SceneManager.x_mousey=n.SceneManager.k_mousey:0!==n.SceneManager.g_mousey&&(n.SceneManager.x_mousey=n.SceneManager.g_mousey);n.SceneManager.horizontal=n.SceneManager.x_horizontal;n.SceneManager.vertical=n.SceneManager.x_vertical;n.SceneManager.mousex=n.SceneManager.x_mousex;n.SceneManager.mousey=n.SceneManager.x_mousey;n.SceneManager.wheel=n.SceneManager.x_wheel;n.SceneManager.x_mousey=0;n.SceneManager.me.updateCameraInput===!0&&null!=n.SceneManager.me.updateCamera&&n.SceneManager.me.autoUpdateCameraUserInput()},t.parseSceneMetadata=function(t,i){window.parsing=!0;var r=i;null==r.manager?(n.SceneManager.CreateManagerSession(t,i),null==r.manager&&n.Tools.Warn("Failed to create a new manager session for current scene.")):n.Tools.Warn("Current scene has already been parsed.");window.parsing=!1},t.parseMeshMetadata=function(t,i){var u,r;window.parsing=!0;u=i;null!=u.manager?(r=(u.manager,[]),n.SceneManager.parseSceneMeshes(t,i,r),r.length>0&&(r.sort(function(n,t){return n.order<t.order?-1:n.order>t.order?1:0}),r.forEach(function(n){n.instance.register()}))):n.Tools.Warn("No scene manager detected for current scene.");window.parsing=!1},t.parseSceneCameras=function(t,i,r){null!=t&&t.length>0&&t.forEach(function(t){if(null!=t.metadata&&t.metadata.api){t.metadata.clone=function(){return n.SceneManager.CloneMetadata(t.metadata)};null!=t.metadata.disposal&&t.metadata.disposal!==!1||(t.onDispose=function(){n.SceneManager.DestroyComponents(t)},t.metadata.disposal=!0);var u=t.metadata;null!=u.components&&u.components.length>0&&u.components.forEach(function(u){if(null!=u.klass&&""!==u.klass&&"BABYLON.SceneComponent"!==u.klass&&"BABYLON.OrthoController"!==u.klass){var f=n.Tools.Instantiate(u.klass);null!=f&&(u.instance=new f(t,i,u.update,u.properties),null!=u.instance&&null!=r&&r.push(u))}});n.SceneManager.setupCameraRigOptions(t,i,r);n.SceneManager.setupAnimationState(t,i)}})},t.parseSceneLights=function(t,i,r){null!=t&&t.length>0&&t.forEach(function(t){if(null!=t.metadata&&t.metadata.api){t.metadata.clone=function(){return n.SceneManager.CloneMetadata(t.metadata)};null!=t.metadata.disposal&&t.metadata.disposal!==!1||(t.onDispose=function(){n.SceneManager.DestroyComponents(t)},t.metadata.disposal=!0);var u=t.metadata;null!=u.components&&u.components.length>0&&u.components.forEach(function(u){if(null!=u.klass&&""!==u.klass&&"BABYLON.SceneComponent"!==u.klass&&"BABYLON.OrthoController"!==u.klass){var f=n.Tools.Instantiate(u.klass);null!=f&&(u.instance=new f(t,i,u.update,u.properties),null!=u.instance&&null!=r&&r.push(u))}});n.SceneManager.setupAnimationState(t,i)}})},t.parseSceneMeshes=function(t,i,r){null!=t&&t.length>0&&(t.forEach(function(t){var u,f,e;if(null!=t.metadata&&t.metadata.api)if(t.metadata.clone=function(){return n.SceneManager.CloneMetadata(t.metadata)},n.SceneManager.setupSharedSkeleton(t,i),t.metadata.prefab===!0)t.setEnabled(!1),n.SceneManager.prefabs[t.name]=t,n.SceneManager.setupLodGroups(t,i,!0);else{if(n.SceneManager.setupLodGroups(t,i,!1),null!=t.metadata.disposal&&t.metadata.disposal!==!1||(t.onDispose=function(){n.SceneManager.DestroyComponents(t)},t.metadata.disposal=!0),"sceneNavigationMesh"===t.name&&null!=i.metadata.properties.hasNavigationMesh&&i.metadata.properties.hasNavigationMesh===!0&&(n.SceneManager.me.hasNavigationMesh()===!1?n.SceneManager.me.buildNavigationMesh(t):n.Tools.Warn("Scene navigation mesh already exists. Ignoring navigation zone building for mesh: "+t.name)),null!=t.metadata.properties&&null!=t.metadata.properties.physicsTag){var s=(t.metadata.properties.physicsTag,t.metadata.properties.physicsMass),o=t.metadata.properties.physicsFriction,h=t.metadata.properties.physicsRestitution,c=t.metadata.properties.physicsImpostor,l=t.metadata.properties.physicsRotation,a=t.metadata.properties.physicsCollisions,v=t.metadata.properties.physicsEnginePlugin;t.physicsImpostor=new n.PhysicsImpostor(t,c,{mass:s,friction:o,restitution:h},i);n.SceneManager.setupPhysicsImpostor(t,v,o,a,l)}u=t.metadata;(null!=u.components&&u.components.length>0&&u.components.forEach(function(u){if(null!=u.klass&&""!==u.klass&&"BABYLON.SceneComponent"!==u.klass&&"BABYLON.OrthoController"!==u.klass){var f=n.Tools.Instantiate(u.klass);null!=f&&(u.instance=new f(t,i,u.update,u.properties),null!=u.instance&&null!=r&&r.push(u))}}),n.SceneManager.setupAnimationState(t,i),n.SceneManager.setupTerrainMeshes(t,i),n.SceneManager.setupSocketMeshes(t,i),null!=t.metadata&&t.metadata.properties&&null!=t.metadata.properties)&&(t.metadata.properties.defaultEllipsoid&&null!=t.metadata.properties.defaultEllipsoid&&t.metadata.properties.defaultEllipsoid.length>=3&&(f=t.metadata.properties.defaultEllipsoid,t.ellipsoid=new n.Vector3(f[0],f[1],f[2])),t.metadata.properties.ellipsoidOffset&&null!=t.metadata.properties.ellipsoidOffset&&t.metadata.properties.ellipsoidOffset.length>=3&&(e=t.metadata.properties.ellipsoidOffset,t.ellipsoidOffset=new n.Vector3(e[0],e[1],e[2])),t.metadata.properties.hasOwnProperty("freezeWorldMatrix")&&t.metadata.properties.freezeWorldMatrix===!0&&t.freezeWorldMatrix(),t.metadata.properties.hasOwnProperty("convertToUnIndexed")&&t.metadata.properties.convertToUnIndexed===!0&&t.convertToUnIndexedMesh(),t.metadata.properties.hasOwnProperty("convertToFlatShaded")&&t.metadata.properties.convertToFlatShaded===!0&&t.convertToFlatShadedMesh())}}),n.SceneManager.postParseSceneMeshes(t,i))},t.postParseSceneMeshes=function(t){var i,u,r,e,f;if(null!=t&&t.length>0&&(i={},t.forEach(function(t){if(null!=t.metadata&&t.metadata.api&&n.SceneManager.staticVertexLimit===!1&&t.metadata.layerIndex===n.SceneManager.StaticIndex&&t.name.indexOf("_StaticMesh_")>=0){t.metadata.layerIndex=-99;var u=t.material.id,r=null;i.hasOwnProperty(u)?r=i[u]:(r=[],i[u]=r);r.push(t)}}),n.SceneManager.staticVertexLimit===!1))for(u in i)i.hasOwnProperty(u)&&(r=i[u],null!=r&&r.length>1&&(e=r[0].parent,f=n.Mesh.MergeMeshes(r,!0,!0),null!=f&&(f.parent=e)))},t.setupLodGroups=function(t,i,r){var u;if(null!=t&&null!=t.metadata&&t.metadata.properties&&null!=t.metadata.properties&&t.metadata.properties.lodGroupInfo&&null!=t.metadata.properties.lodGroupInfo){var f=t.metadata.properties.lodGroupInfo,e=(f.lodCount,f.lodDetails),s=(f.fadeMode,f.crossFading,f.startCulling),o=(f.nearClipingPlane,f.farClipingPlane,f.cameraDistanceFactor,t.getChildMeshes(!1));null!=e&&e.length>0&&null!=o&&o.length>0&&(u=null,e.forEach(function(t){var s=(t.startingPercent,t.endingPercent,t.rendererCount,t.lodRenderers),h=(t.lodDistance,t.startRange);if(null!=s&&s.length>0){var c=s[0],l=c.name,f=n.SceneManager.FindMesh(l,o,n.SearchType.IndexOf),e=null;null!=f&&(null!=f.metadata&&f.metadata.tagName&&null!=f.metadata.tagName&&"[INSTANCE]"===f.metadata.tagName&&f.metadata.properties&&null!=f.metadata.properties&&f.metadata.properties.prefabSource&&null!=f.metadata.properties.prefabSource&&""!==f.metadata.properties.prefabSource&&(e=f,f=i.getMeshByID(f.metadata.properties.prefabSource)),null!=f&&(null==u&&(u=f,u.setEnabled(!1)),f!=u&&(r===!0?(null==n.SceneManager.orphans&&(n.SceneManager.orphans=new n.Mesh("Prefab.Orphans",i),n.SceneManager.orphans.setEnabled(!0),n.SceneManager.orphans.isVisible=!0),f.parent=n.SceneManager.orphans):f.parent=u,u.addLODLevel(h,f),null!=e&&(e.parent=null,e.metadata.tagName=null,e.metadata.prefabSource=null,n.SceneManager.me.safeDestroy(e)))))}}),null!=u&&(s>0&&u.addLODLevel(s,null),u.setEnabled(!0)));t.metadata.properties.lodGroupInfo=null}},t.setupTerrainMeshes=function(t){var i,r,u;null!=t&&null!=t.metadata&&t.metadata.properties&&null!=t.metadata.properties&&(i=0,t.metadata.properties.treeInstances&&null!=t.metadata.properties.treeInstances&&t.metadata.properties.treeInstances.length>0&&(r=t.metadata.properties.treeInstances,r.forEach(function(r){i++;var f=r.prefab,o=(r.color,r.heightScale),u=(r.lightmapColor,r.position),s=r.rotation,e=r.widthScale,h=f+"_"+i.toString(),c=t,l=new n.Vector3(u[0],u[1],u[2]),a=new n.Vector3(0,s,0),v=new n.Vector3(e,o,e);n.SceneManager.me.onready(function(){n.SceneManager.me.instantiatePrefab(f,h,l,a,v,c)})})),(i=0,t.metadata.properties.detailPrototypes&&null!=t.metadata.properties.detailPrototypes&&t.metadata.properties.detailPrototypes.length>0)&&(u=t.metadata.properties.detailPrototypes,u.forEach(function(){})))},t.setupSocketMeshes=function(t,i){if(null!=t&&null!=t.metadata.socketList&&t.metadata.socketList.length>0&&null!=t.skeleton&&null!=t.skeleton.bones&&t.skeleton.bones.length>0){var r=t.metadata.socketList;r.forEach(function(r){var f,u,e,o;if(t.skeleton.bones.length>=r.boneIndex+1&&(f=t.skeleton.bones[r.boneIndex],u=r.boneName+".Socket.",null!=t.parent&&(u+=t.parent.name+"."),u+=t.name+"."+n.Tools.RandomId(),n.SceneManager.showDebugSockets===!0?(r.socketMesh=n.Mesh.CreateBox(u,n.SceneManager.socketColliderSize,i),r.socketMesh.visibility=n.SceneManager.colliderVisibility):r.socketMesh=new n.Mesh(u,i),r.socketMesh.position=new n.Vector3(r.positionX,r.positionY,r.positionZ),r.socketMesh.rotation=new n.Vector3(r.rotationX,r.rotationY,r.rotationZ),r.socketMesh.checkCollisions=!1,r.socketMesh.attachToBone(f,t),null!=r.prefabName&&""!==r.prefabName)){e=new n.Vector3(r.prefabPositionX,r.prefabPositionY,r.prefabPositionZ);o=new n.Vector3(r.prefabRotationX,r.prefabRotationY,r.prefabRotationZ);n.SceneManager.me.onready(function(){n.SceneManager.me.instantiatePrefab(r.prefabName,r.prefabName,e,o,null,r.socketMesh)})}})}},t.setupSharedSkeleton=function(t,i){var u,r,f;null!=t&&null!=t.metadata&&t.metadata.properties&&null!=t.metadata.properties&&t.metadata.properties.sharedSkeletonId&&""!==t.metadata.properties.sharedSkeletonId&&(u=t.metadata.properties.sharedSkeletonId,r=i.getMeshByID(u),null!=r&&null!=r.skeleton?(f=[],null!=r.metadata.animationClips&&r.metadata.animationClips.length>0&&r.metadata.animationClips.forEach(function(t){var i={};n.SceneManager.DeepCopyProperties(t,i);f.push(i)}),t.metadata.animationClips=f,t.skeleton=r.skeleton.clone(t.name,t.name+".Clone."+n.Tools.RandomId())):n.Tools.Warn("Failed to locate source skeleton: "+u))},t.setupPhysicsImpostor=function(t,i,r,u,f){null!=t&&null!=t.physicsImpostor&&t.physicsImpostor.executeNativeFunction(function(e,o){o?0===i&&(o.linearDamping=r,o.angularDamping=r,o.collisionResponse=u,o.angularVelocity.x=0,o.angularVelocity.y=0,o.angularVelocity.z=0,o.velocity.x=0,o.velocity.y=0,o.velocity.z=0,1===f&&(o.fixedRotation=!0,o.updateMassProperties())):n.Tools.Warn("[Physics Native Function]: Null imposter body encountered for physcis mesh "+t.name+". Check physics mesh has no parent transform.")})},t.setupCameraRigOptions=function(t,i){var o,s,f,y,u,c,b,k,l,a;if(null!=t&&null!=t.metadata&&null!=t.metadata.properties){if(t.mode===n.Camera.ORTHOGRAPHIC_CAMERA){var d=t.metadata.properties.orthographicSize||5,v="BABYLON.OrthoController",g=null==i.metadata||null==i.metadata.properties||!i.metadata.properties.hasOwnProperty("resizeCameras")||i.metadata.properties.resizeCameras,e=t.metadata;null==e.components&&(e.components=[]);o=n.Tools.Instantiate(v);null!=o&&(s={orthoSize:d,resizeCameras:g},f=new o(t,i,!1,s),null!=f&&(y={order:1e3,name:"EditorScriptComponent",klass:v,update:!1,properties:s,instance:f,tag:{}},e.components.push(y),f.register()))}if(t.metadata.properties.cameraType)if(u=t.metadata.properties.cameraType,"WebVRFreeCamera"===u||"WebVRGamepadCamera"===u)t.metadata.properties.wvrTrackPosition,t.metadata.properties.wvrPositionScale,t.metadata.properties.wvrDisplayName;else if("VRDeviceOrientationFreeCamera"===u||"VRDeviceOrientationGamepadCamera"===u){var p=t.metadata.properties.vrCameraBridge,nt=t.metadata.properties.vrEyeToScreen,tt=t.metadata.properties.vrInterpupillary,it=t.metadata.properties.vrScreenCenter,rt=t.metadata.properties.vrVerticalRes,ut=t.metadata.properties.vrHorizontalRes,ft=t.metadata.properties.vrVerticalScreen,et=t.metadata.properties.vrHorizontalScreen,ot=t.metadata.properties.vrLensCenterOffset,st=t.metadata.properties.vrLensSeparation,ht=t.metadata.properties.vrPostProcessScale,ct=t.metadata.properties.vrCompensateDistortion,h=t,w=.5-p,lt=.5+p,r=n.VRCameraMetrics.GetDefault();r.eyeToScreenDistance=nt;r.interpupillaryDistance=tt;r.lensSeparationDistance=st;r.lensCenterOffset=ot;r.hResolution=ut;r.vResolution=rt;r.vScreenCenter=it;r.vScreenSize=ft;r.hScreenSize=et;r.postProcessScaleFactor=ht;r.compensateDistortion=ct;h.setCameraRigMode(n.Camera.RIG_MODE_VR,{vrCameraMetrics:r,interaxialDistance:t.interaxialDistance});h._rigCameras[0].viewport=new n.Viewport(0,0,w,1);h._rigCameras[1].viewport=new n.Viewport(lt,0,w,1);i.clearColor=new n.Color4(0,0,0,1)}t.metadata.properties.cameraInput&&t.metadata.properties.cameraInput>0&&(c=t.metadata.properties.cameraInput,1===c?(b=!!t.metadata.properties.hasOwnProperty("preventDefaultEvents")&&t.metadata.properties.preventDefaultEvents,t.attachControl(i.getEngine().getRenderingCanvas(),!b)):2===c&&(k=!0,k&&(l=1,a=.005,t.metadata.properties.cameraMoveSpeed&&(l=t.metadata.properties.cameraMoveSpeed),t.metadata.properties.cameraRotateSpeed&&(a=t.metadata.properties.cameraRotateSpeed),n.SceneManager.me.enableAutoCameraUserInput(t,l,a))))}},t.setupAnimationState=function(t){var i,r,u;null!=t&&null!=t.metadata&&t.metadata.api&&(i=t.metadata,r=n.SceneManager.me.findSceneComponent("BABYLON.AnimationState",t),null!=r&&null!=i.animationEvents&&i.animationEvents.length>0&&null!=i.components&&i.components.length>0&&(u=n.SceneManager.locateOwnerAnimationTrack(0,t,!1),null!=u&&i.animationEvents.forEach(function(t){if(null!=t.functionName&&""!==t.functionName){var i=t.functionName.toLowerCase();u.addEvent(new n.AnimationEvent(t.frame,function(){var n=r,u;null!=n._handlers&&n._handlers[i]&&(u=n._handlers[i],u&&u(t))}))}})))},t.locateOwnerSocketMesh=function(t,i,r){var f,u;if(void 0===r&&(r=n.SearchType.StartsWith),f=null,null!=i&&i.metadata&&null!=i.metadata&&i.metadata.socketList&&null!=i.metadata.socketList&&i.metadata.socketList.length>0)for(var s=i.metadata.socketList,o=null!=r?r:n.SearchType.StartsWith,e=0,e=0;e<s.length;e++)if(u=s[e],o===n.SearchType.StartsWith){if(n.Utilities.StartsWith(u.boneName,t)){f=u.socketMesh;break}}else if(o===n.SearchType.EndsWith){if(n.Utilities.EndsWith(u.boneName,t)){f=u.socketMesh;break}}else if(o===n.SearchType.IndexOf){if(u.boneName.indexOf(t)>=0){f=u.socketMesh;break}}else if(u.boneName===t){f=u.socketMesh;break}return f},t.locateOwnerSocketMeshes=function(n){var t=null,i;return null!=n&&n.metadata&&null!=n.metadata&&n.metadata.socketList&&null!=n.metadata.socketList&&n.metadata.socketList.length>0&&(t=[],i=n.metadata.socketList,i.forEach(function(n){t.push(n.socketMesh)})),t},t.locateOwnerAnimationTrack=function(t,i,r,u){var e,o,s,h,l,f,c;if(void 0===r&&(r=!0),void 0===u&&(u=null),e=null,null!=i&&i instanceof n.AbstractMesh&&(o=i,null!=o.skeleton&&null!=o.skeleton.bones&&o.skeleton.bones.length>0&&o.skeleton.bones[0]&&(s=o.skeleton.bones[0],null!=s.animations&&s.animations.length>t&&null!=s.animations[t]&&(e=s.animations[t]))),(null==e&&null!=i.animations&&i.animations.length>t&&null!=i.animations[t]&&(e=i.animations[t]),null==e&&i instanceof n.AbstractMesh)&&(h=i.getChildMeshes(r,u),null!=h&&h.length>0))for(l=0;l<h.length;l++){if(f=h[l],null!=f.skeleton&&null!=f.skeleton.bones&&f.skeleton.bones.length>0&&f.skeleton.bones[0]&&(c=f.skeleton.bones[0],null!=c.animations&&c.animations.length>t&&null!=c.animations[t])){e=c.animations[t];break}if(null==e&&null!=f.animations&&f.animations.length>0&&f.animations.length>t&&null!=f.animations[t]){e=f.animations[t];break}}return e},t.DestroyComponents=function(n,t){if(void 0===t&&(t=!0),null!=n&&null!=n.metadata&&n.metadata.api){var i=n.metadata;null!=i.components&&i.components.length>0&&i.components.forEach(function(n){null!=n.instance&&(n.instance.dispose(),n.instance=null)});null!=i.socketList&&i.socketList.length>0&&i.socketList.forEach(function(n){null!=n.socketMesh&&(n.socketMesh.dispose(),n.socketMesh=null)});t&&(null!=n.metadata.components&&(n.metadata.components=null),null!=n.metadata.properties&&(n.metadata.properties=null),null!=n.metadata.socketList&&(n.metadata.socketList=null),null!=n.metadata.animationClips&&(n.metadata.animationClips=null),null!=n.metadata.animationEvents&&(n.metadata.animationEvents=null),null!=n.metadata.collisionEvent&&(n.metadata.collisionEvent=null),n.metadata=null)}},t.SetAnimationBlending=function(n,t){if(null!=n)for(var r=n.animations,i=0;i<r.length;i++)r[i].enableBlending=t>0,r[i].blendingSpeed=t},t.SetSkeletonBlending=function(n,t){null!=n&&n.bones.forEach(function(n){n.animations.forEach(function(n){n.enableBlending=t>0;n.blendingSpeed=t})})},t.SetAnimationLooping=function(n,t){if(null!=n)for(var r=n.animations,i=0;i<r.length;i++)r[i].loopMode=t},t.SetSkeletonLooping=function(n,t){null!=n&&n.bones.forEach(function(n){n.animations.forEach(function(n){n.loopMode=t})})},t.SetAnimationProperties=function(n,t,i){if(null!=n)for(var u=n.animations,r=0;r<u.length;r++)u[r].enableBlending=i>0,u[r].blendingSpeed=i,u[r].loopMode=t},t.SetSkeletonProperties=function(n,t,i){null!=n&&n.bones.forEach(function(n){n.animations.forEach(function(n){n.enableBlending=i>0;n.blendingSpeed=i;n.loopMode=t})})},t.FindMesh=function(t,i,r){var f,e,o,u;if(void 0===r&&(r=n.SearchType.StartsWith),f=null,e=null!=r?r:n.SearchType.StartsWith,null!=i&&i.length>0)for(o=0;o<i.length;o++)if(u=i[o],e===n.SearchType.StartsWith){if(n.Utilities.StartsWith(u.name,t)){f=u;break}}else if(e===n.SearchType.EndsWith){if(n.Utilities.EndsWith(u.name,t)){f=u;break}}else if(e===n.SearchType.IndexOf){if(u.name.indexOf(t)>=0){f=u;break}}else if(u.name===t){f=u;break}return f},t.CloneValue=function(t,i){return t?t instanceof n.Mesh?null:t instanceof n.SubMesh?t.clone(i):t.clone?t.clone():t:null},t.CloneMetadata=function(t){var h=null,r,u,f,e,o,i,c,s;return null!=t&&(r={},n.SceneManager.DeepCopyProperties(t.properties,r),u={},n.SceneManager.DeepCopyProperties(t.navAgent,u),f={},n.SceneManager.DeepCopyProperties(t.meshLink,f),e={},n.SceneManager.DeepCopyProperties(t.meshObstacle,e),o=[],null!=t.socketList&&t.socketList.length>0&&t.socketList.forEach(function(t){var i={};n.SceneManager.DeepCopyProperties(t,i);o.push(i)}),i=[],null!=t.animationClips&&t.animationClips.length>0&&t.animationClips.forEach(function(t){var r={};n.SceneManager.DeepCopyProperties(t,r);i.push(r)}),c=[],null!=t.animationEvents&&t.animationEvents.length>0&&t.animationEvents.forEach(function(t){var i={};n.SceneManager.DeepCopyProperties(t,i);c.push(i)}),s=[],null!=t.components&&t.components.length>0&&t.components.forEach(function(t){var i={};n.SceneManager.DeepCopyProperties(t.properties,i);s.push({name:t.name,klass:t.klass,order:t.order,tag:t.tag,update:t.update,properties:i,instance:null})}),h={api:!0,type:t.type,prefab:!1,state:{},objectName:t.objectName,objectId:t.objectId,tagName:t.tagName,layerIndex:t.layerIndex,layerName:t.layerName,areaIndex:t.areaIndex,navAgent:u,meshLink:f,meshObstacle:e,socketList:o,animationClips:i,animationEvents:i,collisionEvent:null,components:s,properties:r}),h},t.DeepCopyProperties=function(t,i,r,u){var f,e,s,o,h;for(f in t)if(("_"!==f[0]||u&&u.indexOf(f)!==-1)&&(!r||r.indexOf(f)===-1)&&(e=t[f],s=typeof e,"function"!==s))if("object"===s)if(e instanceof Array){if(i[f]=[],e.length>0)if("object"==typeof e[0])for(o=0;o<e.length;o++)h=n.SceneManager.CloneValue(e[o],i),i[f].indexOf(h)===-1&&i[f].push(h);else i[f]=e.slice(0)}else i[f]=n.SceneManager.CloneValue(e,i);else i[f]=e},t.me=null,t.min=Number.MIN_VALUE,t.max=Number.MAX_VALUE-100,t.keymap={},t.prefabs=null,t.wheel=0,t.clientx=0,t.clienty=0,t.mousex=0,t.mousey=0,t.vertical=0,t.horizontal=0,t.x_wheel=0,t.x_mousex=0,t.x_mousey=0,t.x_vertical=0,t.x_horizontal=0,t.k_mousex=0,t.k_mousey=0,t.k_vertical=0,t.k_horizontal=0,t.j_mousex=0,t.j_mousey=0,t.j_vertical=0,t.j_horizontal=0,t.g_mousex=0,t.g_mousey=0,t.g_vertical=0,t.g_horizontal=0,t.engine=null,t.orphans=null,t.gamepad=null,t.gamepadType=n.GamepadType.None,t.gamepadManager=null,t.gamepadConnected=null,t.gamepadButtonPress=[],t.gamepadButtonDown=[],t.gamepadButtonUp=[],t.gamepadDpadPress=[],t.gamepadDpadDown=[],t.gamepadDpadUp=[],t.gamepadLeftTrigger=[],t.gamepadRightTrigger=[],t.mouseButtonPress=[],t.mouseButtonDown=[],t.mouseButtonUp=[],t.keyButtonPress=[],t.keyButtonDown=[],t.keyButtonUp=[],t.leftJoystick=null,t.rightJoystick=null,t.virtualJoystick=!1,t.showDebugSockets=!1,t.colliderVisibility=.25,t.socketColliderSize=.125,t.staticVertexLimit=!1,t.previousPosition=null,t.preventDefault=!1,t.rightHanded=!0,t.loader=null,t.readies=[],t}();n.SceneManager=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(n){if(null==n)throw new Error("Null owner agent mesh specified.");this._mesh=n;this._info=null!=this._mesh.metadata&&null!=this._mesh.metadata.navAgent?this._mesh.metadata.navAgent:null}return Object.defineProperty(t.prototype,"mesh",{get:function(){return this._mesh},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"info",{get:function(){return this._info},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasAgentInfo",{get:function(){return null!=this.info},enumerable:!0,configurable:!0}),t.prototype.setDestination=function(){this.hasAgentInfo||n.Tools.Warn("Null navigation agent metadata. Set agent destination ignored.")},t}();n.NavigationAgent=t}(BABYLON||(BABYLON={}));__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(n){var t=function(t){function i(n,i,r,u){void 0===r&&(r=!0);void 0===u&&(u={});var f=t.call(this,n,i,r,u)||this;return f._time=0,f._auto=!1,f._shader=null,f._effect=null,f._shuriken=null,f.updateTime=!1,f.maximumTime=0,f._uniforms=[],f._samplers=[],f._textures={},f._textureArrays={},f._floats={},f._floatsArrays={},f._colors3={},f._colors4={},f._vectors2={},f._vectors3={},f._vectors4={},f._matrices={},f._matrices3x3={},f._matrices2x2={},f._vectors3Arrays={},f._time=0,f._auto=!1,f._effect=null,f._shuriken=null,f._shader=null,f.updateTime=!1,f.maximumTime=0,f.initializeParticleSystem(),f}return __extends(i,t),Object.defineProperty(i.prototype,"shuriken",{get:function(){return this._shuriken},enumerable:!0,configurable:!0}),i.prototype.start=function(){this.updateTime===!0&&this.setEffectTime(0);this._auto===!0&&null!=this._shuriken&&this._shuriken.start()},i.prototype.update=function(){this.updateTime===!0&&this.setEffectTime(this._time+this.manager.deltaTime)},i.prototype.destroy=function(){var t,i;(null!=this._effect&&(this._effect.onBind=null,this._effect=null),null!=this._shuriken)&&(t=this._shuriken,t._customEffect&&(t._customEffect=null),t=null,this._shuriken.dispose(),this._shuriken=null);null!=this._shader&&""!==this._shader&&(i=this._shader+"FragmentShader",n.Effect.ShadersStore[i]&&delete n.Effect.ShadersStore[i])},Object.defineProperty(i.prototype,"textures",{get:function(){return this._textures},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"textureArray",{get:function(){return this._textureArrays},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"floats",{get:function(){return this._floats},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"floatsArrays",{get:function(){return this._floatsArrays},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"colors3",{get:function(){return this._colors3},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"colors4",{get:function(){return this._colors4},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vectors2",{get:function(){return this._vectors2},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vectors3",{get:function(){return this._vectors3},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vectors4",{get:function(){return this._vectors4},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"matrices",{get:function(){return this._matrices},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"matrices3x3",{get:function(){return this._matrices3x3},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"matrices2x2",{get:function(){return this._matrices2x2},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vectors3Arrays",{get:function(){return this._vectors3Arrays},enumerable:!0,configurable:!0}),i.prototype.setTexture=function(n,t){return this._textures[n]=t,this},i.prototype.setTextureArray=function(n,t){return this._samplers.indexOf(n)===-1&&this._samplers.push(n),this._textureArrays[n]=t,this},i.prototype.setFloat=function(n,t){return this._floats[n]=t,this},i.prototype.setFloats=function(n,t){return this._floatsArrays[n]=t,this},i.prototype.setColor3=function(n,t){return this._colors3[n]=t,this},i.prototype.setColor4=function(n,t){return this._colors4[n]=t,this},i.prototype.setVector2=function(n,t){return this._vectors2[n]=t,this},i.prototype.setVector3=function(n,t){return this._vectors3[n]=t,this},i.prototype.setVector4=function(n,t){return this._vectors4[n]=t,this},i.prototype.setMatrix=function(n,t){return this._matrices[n]=t,this},i.prototype.setMatrix3x3=function(n,t){return this._matrices3x3[n]=t,this},i.prototype.setMatrix2x2=function(n,t){return this._matrices2x2[n]=t,this},i.prototype.setArray3=function(n,t){return this._vectors3Arrays[n]=t,this},i.prototype.getEffectTime=function(){return this._time},i.prototype.setEffectTime=function(n){this._time=n;this.maximumTime>0&&this._time>=this.maximumTime&&(this._time=0);this.setFloat("time",this._time)},i.prototype.bindParticleSystemEffect=function(n,t){var i,r,u;if(n.scene.texturesEnabled)for(i in n._textures)r=n._textures[i],r&&(t.setTexture(i,r),t.setFloat2(i+"Infos",r.coordinatesIndex,r.level),t.setFloat2(i+"Scale",r.uScale,r.vScale),t.setMatrix(i+"Matrix",r.getTextureMatrix()));if(n.scene.texturesEnabled)for(i in n._textureArrays)t.setTextureArray(i,n._textureArrays[i]);for(i in n._floats)t.setFloat(i,n._floats[i]);for(i in n._floatsArrays)t.setArray(i,n._floatsArrays[i]);for(i in n._colors3)t.setColor3(i,n._colors3[i]);for(i in n._colors4)u=n._colors4[i],t.setFloat4(i,u.r,u.g,u.b,u.a);for(i in n._vectors2)t.setVector2(i,n._vectors2[i]);for(i in n._vectors3)t.setVector3(i,n._vectors3[i]);for(i in n._vectors4)t.setVector4(i,n._vectors4[i]);for(i in n._matrices)t.setMatrix(i,n._matrices[i]);for(i in n._matrices3x3)t.setMatrix3x3(i,n._matrices3x3[i]);for(i in n._matrices2x2)t.setMatrix2x2(i,n._matrices2x2[i]);for(i in n._vectors3Arrays)t.setArray3(i,n._vectors3Arrays[i])},i.prototype.initializeParticleSystem=function(){var l,i,u,v,y,p,e,w,o,b,s,k,h,d,g,nt,tt,it,rt,ut,ft,r,et,ot;this._auto=this.getProperty("autoStart",!1);var st=this.getProperty("capacity",100),t=this.getProperty("particleName",null),ht=this.getProperty("startSpeed",.01),ct=this.getProperty("emitType",0),lt=this.getProperty("duration",10);if(null!=t&&""!==t||(t="PX_Unknown_"+n.Tools.RandomId()),l=this.getProperty("emitBurst",null),i=this.getProperty("ShurikenUpdateModules",null),null!=i&&(this.updateTime=i.updateEffectTime,this.maximumTime=i.maximumEffectTime),u=this.getProperty("customShaderEffect",null),null!=u&&""!==u){var a=this,f=this.getProperty("customShaderDefines",null),at=this.getProperty("customShaderUniforms",null),vt=this.getProperty("customShaderSamplers",null),yt=null!=f&&f.length>0?f.join("\n"):null;this._shader="PX_"+this.mesh.name+"_"+t.replace("PX_","")+"_"+n.Tools.RandomId().replace(".","")+"_Effect";v=u+"FragmentShader";y=this._shader+"FragmentShader";n.Effect.ShadersStore[y]=n.Effect.ShadersStore[v];this._effect=this.engine.createEffectForParticles(this._shader,at,vt,yt);this._effect.onBind=function(n){a.bindParticleSystemEffect(a,n)}}this._shuriken=new n.ShurikenParticleSystem(t,st,this.scene,lt,ct,ht,l,i,this._effect);this._shuriken.emitter=this.mesh;this._shuriken.blendMode=this.getProperty("blendMode",0);this._shuriken.emitRate=this.getProperty("emitRate",100);this._shuriken.loopPlay=this.getProperty("loopPlay",!1);this._shuriken.delayTime=this.getProperty("delayTime",0);p=this.getProperty("lifeTime");e=n.Utilities.ParseVector2(p,new n.Vector2(1,1));this._shuriken.minLifeTime=e.x;this._shuriken.maxLifeTime=e.y;w=this.getProperty("emitPower");o=n.Utilities.ParseVector2(w,new n.Vector2(1,1));this._shuriken.minEmitPower=o.x;this._shuriken.maxEmitPower=o.y;b=this.getProperty("angularSpeed");s=n.Utilities.ParseVector2(b,new n.Vector2(0,0));this._shuriken.minAngularSpeed=s.x;this._shuriken.maxAngularSpeed=s.y;k=this.getProperty("particleSize");h=n.Utilities.ParseVector2(k,new n.Vector2(1,1));this._shuriken.minSize=h.x;this._shuriken.maxSize=h.y;d=this.getProperty("color1");this._shuriken.color1=n.Utilities.ParseColor4(d,new n.Color4(1,1,1,1));g=this.getProperty("color2");this._shuriken.color2=n.Utilities.ParseColor4(g,new n.Color4(1,1,1,1));nt=this.getProperty("colorDead");this._shuriken.colorDead=n.Utilities.ParseColor4(nt,new n.Color4(0,0,0,1));tt=this.getProperty("textureMask");this._shuriken.textureMask=n.Utilities.ParseColor4(tt,new n.Color4(1,1,1,1));it=this.getProperty("direction1");this._shuriken.direction1=n.Utilities.ParseVector3(it,new n.Vector3(0,1,0));rt=this.getProperty("direction2");this._shuriken.direction2=n.Utilities.ParseVector3(rt,new n.Vector3(0,1,0));ut=this.getProperty("minEmitBox");this._shuriken.minEmitBox=n.Utilities.ParseVector3(ut,new n.Vector3(0,0,0));ft=this.getProperty("maxEmitBox");this._shuriken.maxEmitBox=n.Utilities.ParseVector3(ft,new n.Vector3(0,0,0));var pt=this.getProperty("gravityVector"),wt=this.getProperty("gravityMode",0),c=this.getProperty("gravityMultiplier",1);this._shuriken.gravity=1===wt?this.scene.gravity.multiplyByFloats(c,c,c):n.Utilities.ParseVector3(pt,new n.Vector3(0,0,0));r=this.getProperty("textureImage",null);null!=r&&r.name&&""!==r.name&&(et=r.name,ot=this.manager.getScenePath(),this._shuriken.particleTexture=new n.Texture(ot+et,this.scene))},i}(n.MeshComponent);n.UniversalParticleSystem=t}(BABYLON||(BABYLON={}));__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(n){var t=function(t){function i(i,r,u,f){void 0===u&&(u=!0);void 0===f&&(f={});var e=t.call(this,i,r,u,f)||this;return e.movementType=n.MovementType.DirectVelocity,e.avatarHeight=2,e.avatarRadius=.25,e.fallingVelocity=.1,e.slidingVelocity=.25,e.onPhysicsContact=null,e._jumping=!1,e._falling=!1,e._sliding=!1,e._grounded=!0,e._threashold=.5,e._velocity=n.Vector3.Zero(),e._angularVelocity=n.Vector3.Zero(),e._jumpingVelocity=n.Vector3.Zero(),e.movementType=e.getProperty("movementType",n.MovementType.DirectVelocity),e.avatarHeight=e.getProperty("avatarHeight",2),e.avatarRadius=e.getProperty("avatarRadius",.25),e.fallingVelocity=e.getProperty("fallingVelocity",.1),e.slidingVelocity=e.getProperty("slidingVelocity",.25),e}return __extends(i,t),i.prototype.isJumping=function(){return this._jumping},i.prototype.isFalling=function(){return this._falling},i.prototype.isSliding=function(){return this._sliding},i.prototype.isGrounded=function(){return this._grounded},i.prototype.getVelocity=function(){return this._velocity},i.prototype.getFriction=function(){return this.manager.getFrictionLevel(this.mesh)},i.prototype.setFriction=function(n){this.manager.applyFriction(this.mesh,n)},i.prototype.start=function(){var t=this;this._jumping=!1;this._falling=!1;this._sliding=!1;this._grounded=!0;this.updateGroundingState();this.onCollisionEvent(function(i,r){t.manager.checkCollisionContact(t.mesh,i,n.CollisionContact.Bottom,t._threashold)===!0&&(t._jumping=!1,t.updateGroundingState());null!=t.onPhysicsContact&&t.onPhysicsContact(i,r)})},i.prototype.update=function(){this.updateGroundingState()},i.prototype.after=function(){this.updateGroundingState()},i.prototype.updateGroundingState=function(){this._grounded=this._jumping===!1;this._velocity=this.manager.getLinearVelocity(this.mesh);this._falling=null!=this._velocity&&this._velocity.y<-this.fallingVelocity;this._sliding=this._grounded===!0&&null!=this._velocity&&this._velocity.y<-this.slidingVelocity},i.prototype.move=function(t,i,r){void 0===i&&(i=0);void 0===r&&(r=0);this.manager.applyFriction(this.mesh,i);this.movementType===n.MovementType.AppliedForces?this.manager.applyForce(this.mesh,t,this.mesh.getAbsolutePosition()):this.manager.setLinearVelocity(this.mesh,t);r>0&&(this._jumping=!0,this._jumpingVelocity.copyFromFloats(0,r,0),this.manager.applyImpulse(this.mesh,this._jumpingVelocity,this.mesh.getAbsolutePosition()),this.updateGroundingState())},i.prototype.rotate=function(n){this._angularVelocity.copyFromFloats(0,n,0);this.manager.setAngularVelocity(this.mesh,this._angularVelocity)},i}(n.MeshComponent);n.CharacterController=t}(BABYLON||(BABYLON={}));!function(n){var r=function(){function t(){}return t.Warning=function(t){n.Tools.Warn(t)},t.Loader=null,t}(),t,i;n.ToolkitPlugin=r;t=function(){function t(){this.name="toolkit.json";this.extensions={".babylon":{isBinary:!1}}}return t.prototype.load=function(t,i,r){var u=!1;return null!=n.ToolkitPlugin.Loader?(u=n.ToolkitPlugin.Loader.load(t,i,r,n.ToolkitPlugin.Warning),u===!0?n.SceneManager.parseSceneMetadata(r,t):n.Tools.Warn("Toolkit: Failed to load json scene data")):n.Tools.Warn("Toolkit: Null registered babylon file loader plugin"),u},t.prototype.importMesh=function(t,i,r,u,f,e,o){var s=!1;return null!=n.ToolkitPlugin.Loader?(s=n.ToolkitPlugin.Loader.importMesh(t,i,r,u,f,e,o,n.ToolkitPlugin.Warning),s===!0?n.SceneManager.parseMeshMetadata(f,i):n.Tools.Warn("Toolkit: Failed to load json scene data")):n.Tools.Warn("Toolkit: Null registered babylon file loader plugin"),s},t}();n.JsonSceneLoader=t;i=function(){function t(){this.name="toolkit.binary";this.extensions={".bin":{isBinary:!0}}}return t.prototype.load=function(t,i,r){var u,f,e;return window.decoding=!0,u=new Uint8Array(i),f=n.Utilities.DecompressToString(u),(window.decoding=!1,null!=n.ToolkitPlugin.Loader)?(e=n.ToolkitPlugin.Loader.load(t,f,r,n.ToolkitPlugin.Warning),e===!0?n.SceneManager.parseSceneMetadata(r,t):n.Tools.Warn("Toolkit: Failed to load binary scene data")):n.Tools.Warn("Toolkit: Null registered babylon file loader plugin"),f=null,u=null,e},t.prototype.importMesh=function(t,i,r,u,f,e,o){var s,h,c;return window.decoding=!0,s=new Uint8Array(r),h=n.Utilities.DecompressToString(s),(window.decoding=!1,null!=n.ToolkitPlugin.Loader)?(c=n.ToolkitPlugin.Loader.importMesh(t,i,h,u,f,e,o,n.ToolkitPlugin.Warning),c===!0?n.SceneManager.parseMeshMetadata(f,i):n.Tools.Warn("Toolkit: Failed to load json scene data")):n.Tools.Warn("Toolkit: Null registered babylon file loader plugin"),h=null,s=null,c},t}();n.BinarySceneLoader=i}(BABYLON||(BABYLON={}));BABYLON.ToolkitPlugin.Loader=BABYLON.SceneLoader.GetPluginForExtension(".babylon");BABYLON.SceneLoader.RegisterPlugin(new BABYLON.JsonSceneLoader);BABYLON.SceneLoader.RegisterPlugin(new BABYLON.BinarySceneLoader);BABYLON.Tools.Log("Toolkit: Scene manager loader plugins registered");__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(n){var u=function(){function n(){this._defines={};this._defines={}}return n.prototype.getDefines=function(){return this._defines},n.prototype.resetDefines=function(){return this._defines={}},n.prototype.defineBoolean=function(n){this._defines[n]=!0},n.prototype.defineNumeric=function(n,t){this._defines[n]=t},n}(),t,i,r;n.UniversalShaderDefines=u;t=function(t){function i(n,i,r){void 0===r&&(r=!1);var u=t.call(this,n,i)||this;return u.ticking=!1,u._manager=null,u._started=!1,u._register=null,u._before=null,u._after=null,u._destroy=null,u.ticking=r,u.ticking&&u.initializeInstance(),u}return __extends(i,t),i.prototype.start=function(){},i.prototype.update=function(){},i.prototype.after=function(){},i.prototype.destroy=function(){},i.prototype.getManager=function(){return null==this._manager&&(this._manager=n.SceneManager.GetInstance()),this._manager},i.prototype.initializeInstance=function(){this._started=!1;var n=this;n._register=function(){n.registerInstance(n)};n._before=function(){n.updateInstance(n)};n._after=function(){n.afterInstance(n)};n._destroy=function(){n.destoryInstance(n)};n._register()},i.prototype.registerInstance=function(n){n.getScene().registerBeforeRender(n._before);n.getScene().registerAfterRender(n._after)},i.prototype.updateInstance=function(n){n._started?n.update():(n.start(),n._started=!0)},i.prototype.afterInstance=function(n){n._started&&n.after()},i.prototype.destoryInstance=function(n){n.getScene().unregisterBeforeRender(n._before);n.getScene().unregisterAfterRender(n._after);n.destroy();n._started=!1;n._register=null;n._before=null;n._after=null;n._destroy=null},i.prototype.dispose=function(n,i){this._destroy();t.prototype.dispose.call(this,n,i)},i}(n.PushMaterial);n.UniversalPushMaterial=t;i=function(t){function i(i,r,u){void 0===u&&(u=!1);var f=t.call(this,i,r)||this;return f.tick=!0,f.ticking=!1,f.program="default",f._locals=null,f._uniforms=[],f._samplers=[],f._textures={},f._textureArrays={},f._floats={},f._floatsArrays={},f._colors3={},f._colors4={},f._vectors2={},f._vectors3={},f._vectors4={},f._matrices={},f._matrices3x3={},f._matrices2x2={},f._vectors3Arrays={},f._manager=null,f._started=!1,f._register=null,f._before=null,f._after=null,f._destroy=null,f.ticking=u,f._locals=new n.UniversalShaderDefines,f.customShaderNameResolve=f._buildCustomShader,f.ticking&&f.initializeInstance(),f}return __extends(i,t),i.prototype.start=function(){},i.prototype.update=function(){},i.prototype.define=function(){},i.prototype.after=function(){},i.prototype.destroy=function(){},Object.defineProperty(i.prototype,"textures",{get:function(){return this._textures},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"textureArray",{get:function(){return this._textureArrays},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"floats",{get:function(){return this._floats},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"floatsArrays",{get:function(){return this._floatsArrays},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"colors3",{get:function(){return this._colors3},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"colors4",{get:function(){return this._colors4},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vectors2",{get:function(){return this._vectors2},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vectors3",{get:function(){return this._vectors3},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vectors4",{get:function(){return this._vectors4},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"matrices",{get:function(){return this._matrices},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"matrices3x3",{get:function(){return this._matrices3x3},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"matrices2x2",{get:function(){return this._matrices2x2},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vectors3Arrays",{get:function(){return this._vectors3Arrays},enumerable:!0,configurable:!0}),i.prototype.setTexture=function(n,t){return this._checkSampler(n),this._textures[n]=t,this},i.prototype.setTextureArray=function(n,t){return this._samplers.indexOf(n)===-1&&this._samplers.push(n),this._checkUniform(n),this._textureArrays[n]=t,this},i.prototype.setFloat=function(n,t){return this._checkUniform(n),this._floats[n]=t,this},i.prototype.setFloats=function(n,t){return this._checkUniform(n),this._floatsArrays[n]=t,this},i.prototype.setColor3=function(n,t){return this._checkUniform(n),this._colors3[n]=t,this},i.prototype.setColor4=function(n,t){return this._checkUniform(n),this._colors4[n]=t,this},i.prototype.setVector2=function(n,t){return this._checkUniform(n),this._vectors2[n]=t,this},i.prototype.setVector3=function(n,t){return this._checkUniform(n),this._vectors3[n]=t,this},i.prototype.setVector4=function(n,t){return this._checkUniform(n),this._vectors4[n]=t,this},i.prototype.setMatrix=function(n,t){return this._checkUniform(n),this._matrices[n]=t,this},i.prototype.setMatrix3x3=function(n,t){return this._checkUniform(n),this._matrices3x3[n]=t,this},i.prototype.setMatrix2x2=function(n,t){return this._checkUniform(n),this._matrices2x2[n]=t,this},i.prototype.setArray3=function(n,t){return this._checkUniform(n),this._vectors3Arrays[n]=t,this},i.prototype.isReadyForSubMesh=function(n,i,r){var o,l,u,f,s,h,e,c;if(this._locals.resetDefines(),this.define(this._locals),o=!1,l=this.getScene(),l.texturesEnabled){f=!0;for(u in this._textures)s=this._textures[u],s&&s.isReadyOrNotBlocking()?(o=!0,this._locals.defineBoolean(u+"Def"),this._checkUniform(u+"Infos"),this._checkUniform(u+"Scale"),this._checkUniform(u+"Matrix")):f=!1;if(!f)return!1;f=!0;for(u in this._textureArrays)for(this._locals.defineBoolean(u+"Def"),h=this._textureArrays[u],e=0;e<h.length;e++)c=h[e],c&&c.isReadyOrNotBlocking()?o=!0:f=!1;if(!f)return!1}return t.prototype.isReadyForSubMesh.call(this,n,i,r)},i.prototype.getAnimatables=function(){var i,u=t.prototype.getAnimatables.call(this),f,r,n;for(i in this._textures)n=this._textures[i],n&&u.push(n);for(i in this._textureArrays)for(f=this._textureArrays[i],r=0;r<f.length;r++)n=f[r],n&&u.push(n);return u},i.prototype.getActiveTextures=function(){var i,u=t.prototype.getActiveTextures.call(this),f,r,n;for(i in this._textures)n=this._textures[i],n&&u.push(n);for(i in this._textureArrays)for(f=this._textureArrays[i],r=0;r<f.length;r++)n=f[r],n&&u.push(n);return u},i.prototype.hasTexture=function(n){var r,i,f,e,u,o;if(t.prototype.hasTexture.call(this,n))return!0;i=!1;for(r in this._textures)if(f=this._textures[r],f&&f===n){i=!0;break}if(i===!1)for(r in this._textureArrays){for(e=this._textureArrays[r],u=0;u<e.length;u++)if(o=e[u],o&&o===n){i=!0;break}if(i===!0)break}return i},i.prototype.clone=function(t){var r=this,i=n.SerializationHelper.Clone(function(){return new n.UniversalShaderMaterial(t,r.getScene())},this);return n.UniversalShaderMaterial.CloneCustomProperties(this,i),i},i.prototype.serialize=function(){var t=n.SerializationHelper.Serialize(this);return t.customType="BABYLON.UniversalShaderMaterial",n.UniversalShaderMaterial.SerializeCustomProperties(this,t),t},i.Parse=function(t,i,r){var u=n.SerializationHelper.Parse(function(){return new n.UniversalShaderMaterial(t.name,i)},t,i,r);return n.UniversalShaderMaterial.ParseCustomProperties(u,t,i,r),u},i.CloneCustomProperties=function(n,t){var i,r;if(null!=n&&null!=t){t._textures={};for(i in n._textures)r=n._textures[i],r&&t.setTexture(i,r.clone());t._textureArrays={};for(i in n._textureArrays){t._textureArrays[i]=[];for(var f=n._textureArrays[i],e=[],u=0;u<f.length;u++)e.push(f[u].clone());t.setTextureArray(i,e)}t._floats={};for(i in n._floats)t.setFloat(i,n._floats[i]);t._floatsArrays={};for(i in n._floatsArrays)t.setFloats(i,n._floatsArrays[i]);t._colors3={};for(i in n._colors3)t.setColor3(i,n._colors3[i].clone());t._colors4={};for(i in n._colors4)t.setColor4(i,n._colors4[i].clone());t._vectors2={};for(i in n._vectors2)t.setVector2(i,n._vectors2[i].clone());t._vectors3={};for(i in n._vectors3)t.setVector3(i,n._vectors3[i].clone());t._vectors4={};for(i in n._vectors4)t.setVector4(i,n._vectors4[i].clone());t._matrices={};for(i in n._matrices)t.setMatrix(i,n._matrices[i].clone());t._matrices3x3={};for(i in n._matrices3x3)t.setMatrix3x3(i,n._matrices3x3[i]);t._matrices2x2={};for(i in n._matrices2x2)t.setMatrix2x2(i,n._matrices2x2[i]);t._vectors3Arrays={};for(i in n._vectors3Arrays)t.setArray3(i,n._vectors3Arrays[i])}},i.SerializeCustomProperties=function(n,t){var i,u,f,r;if(null!=t&&null!=n){t.textures={};for(i in n._textures)u=n._textures[i],u&&(t.textures[i]=u.serialize());t.textureArrays={};for(i in n._textureArrays)for(t.textureArrays[i]=[],f=n._textureArrays[i],r=0;r<f.length;r++)t.textureArrays[i].push(f[r].serialize());t.floats={};for(i in n._floats)t.floats[i]=n._floats[i];t.floatsArrays={};for(i in n._floatsArrays)t.floatsArrays[i]=n._floatsArrays[i];t.colors3={};for(i in n._colors3)t.colors3[i]=n._colors3[i].asArray();t.colors4={};for(i in n._colors4)t.colors4[i]=n._colors4[i].asArray();t.vectors2={};for(i in n._vectors2)t.vectors2[i]=n._vectors2[i].asArray();t.vectors3={};for(i in n._vectors3)t.vectors3[i]=n._vectors3[i].asArray();t.vectors4={};for(i in n._vectors4)t.vectors4[i]=n._vectors4[i].asArray();t.matrices={};for(i in n._matrices)t.matrices[i]=n._matrices[i].asArray();t.matrices3x3={};for(i in n._matrices3x3)t.matrices3x3[i]=n._matrices3x3[i];t.matrices2x2={};for(i in n._matrices2x2)t.matrices2x2[i]=n._matrices2x2[i];t.vectors3Arrays={};for(i in n._vectors3Arrays)t.vectors3Arrays[i]=n._vectors3Arrays[i]}},i.ParseCustomProperties=function(t,i,r,u){var f,e;if(null!=i&&null!=t){for(f in i.textures)e=i.textures[f],e&&t.setTexture(f,n.Texture.Parse(e,r,u));for(f in i.textureArrays){for(var s=i.textureArrays[f],h=[],o=0;o<s.length;o++)h.push(n.Texture.Parse(s[o],r,u));t.setTextureArray(f,h)}for(f in i.floats)t.setFloat(f,i.floats[f]);for(f in i.floatsArrays)t.setFloats(f,i.floatsArrays[f]);for(f in i.colors3)t.setColor3(f,n.Color3.FromArray(i.colors3[f]));for(f in i.colors4)t.setColor4(f,n.Color4.FromArray(i.colors4[f]));for(f in i.vectors2)t.setVector2(f,n.Vector2.FromArray(i.vectors2[f]));for(f in i.vectors3)t.setVector3(f,n.Vector3.FromArray(i.vectors3[f]));for(f in i.vectors4)t.setVector4(f,n.Vector4.FromArray(i.vectors4[f]));for(f in i.matrices)t.setMatrix(f,n.Matrix.FromArray(i.matrices[f]));for(f in i.matrices3x3)t.setMatrix3x3(f,i.matrices3x3[f]);for(f in i.matrices2x2)t.setMatrix2x2(f,i.matrices2x2[f]);for(f in i.vectors3Arrays)t.setArray3(f,i.vectors3Arrays[f])}},i.prototype.getManager=function(){return null==this._manager&&(this._manager=n.SceneManager.GetInstance()),this._manager},i.prototype._checkUniform=function(n){this._uniforms.indexOf(n)===-1&&this._uniforms.push(n)},i.prototype._checkSampler=function(n){this._samplers.indexOf(n)===-1&&this._samplers.push(n)},i.prototype._buildCustomShader=function(n,t,i,r,u){var a=this,e,o,h,f,c;if(null!=this.program&&""!==this.program||(this.program="default"),e=this._locals.getDefines(),null!=e&&(o=Object.keys(e),null!=o&&o.length>0)){for(var v=u,s=0,l=o;s<l.length;s++)h=l[s],v[h]=e[h];u.rebuild()}if(f=0,null!=this._uniforms&&this._uniforms.length>0)for(f=0;f<this._uniforms.length;f++)t.push(this._uniforms[f]);if(f=0,null!=this._samplers&&this._samplers.length>0)for(f=0;f<this._samplers.length;f++)r.push(this._samplers[f]);return c=this._afterBind,this._afterBind=function(n,t){if(a._attachAfterBind(n,t),c)try{c(n,t)}catch(i){}},this.program},i.prototype._attachAfterBind=function(n,t){var i,f=this.getScene(),r,u;if(f.texturesEnabled)for(i in this._textures)r=this._textures[i],r&&(t.setTexture(i,r),t.setFloat2(i+"Infos",r.coordinatesIndex,r.level),t.setFloat2(i+"Scale",r.uScale,r.vScale),t.setMatrix(i+"Matrix",r.getTextureMatrix()));if(f.texturesEnabled)for(i in this._textureArrays)t.setTextureArray(i,this._textureArrays[i]);for(i in this._floats)t.setFloat(i,this._floats[i]);for(i in this._floatsArrays)t.setArray(i,this._floatsArrays[i]);for(i in this._colors3)t.setColor3(i,this._colors3[i]);for(i in this._colors4)u=this._colors4[i],t.setFloat4(i,u.r,u.g,u.b,u.a);for(i in this._vectors2)t.setVector2(i,this._vectors2[i]);for(i in this._vectors3)t.setVector3(i,this._vectors3[i]);for(i in this._vectors4)t.setVector4(i,this._vectors4[i]);for(i in this._matrices)t.setMatrix(i,this._matrices[i]);for(i in this._matrices3x3)t.setMatrix3x3(i,this._matrices3x3[i]);for(i in this._matrices2x2)t.setMatrix2x2(i,this._matrices2x2[i]);for(i in this._vectors3Arrays)t.setArray3(i,this._vectors3Arrays[i])},i.prototype.initializeInstance=function(){this._started=!1;var n=this;n._register=function(){n.registerInstance(n)};n._before=function(){n.updateInstance(n)};n._after=function(){n.afterInstance(n)};n._destroy=function(){n.destoryInstance(n)};n._register()},i.prototype.registerInstance=function(n){n.getScene().registerBeforeRender(n._before);n.getScene().registerAfterRender(n._after)},i.prototype.updateInstance=function(n){n._started?n.update():(n.start(),n._started=!0)},i.prototype.afterInstance=function(n){n._started&&n.after()},i.prototype.destoryInstance=function(n){n.getScene().unregisterBeforeRender(n._before);n.getScene().unregisterAfterRender(n._after);n.destroy();n._started=!1;n._register=null;n._before=null;n._after=null;n._destroy=null},i.prototype.dispose=function(n,i){var r,f,e,u;if(i){for(r in this._textures)f=this._textures[r],f&&f.dispose(),this._textures[r]=null;for(r in this._textureArrays)for(e=this._textureArrays[r],u=0;u<e.length;u++)e[u].dispose()}this._textures={};this._destroy();t.prototype.dispose.call(this,n,i)},i}(n.StandardMaterial);n.UniversalShaderMaterial=i;r=function(t){function i(n,i,r){void 0===r&&(r=!1);var u=t.call(this,n,i,r)||this;return u.program="splatmap",u}return __extends(i,t),i.prototype.clone=function(t){var r=this,i=n.SerializationHelper.Clone(function(){return new n.UniversalTerrainMaterial(t,r.getScene())},this);return n.UniversalShaderMaterial.CloneCustomProperties(this,i),i},i.prototype.serialize=function(){var t=n.SerializationHelper.Serialize(this);return t.customType="BABYLON.UniversalTerrainMaterial",n.UniversalShaderMaterial.SerializeCustomProperties(this,t),t},i.Parse=function(t,i,r){var u=n.SerializationHelper.Parse(function(){return new n.UniversalTerrainMaterial(t.name,i)},t,i,r);return n.UniversalShaderMaterial.ParseCustomProperties(u,t,i,r),u},i}(n.UniversalShaderMaterial);n.UniversalTerrainMaterial=r}(BABYLON||(BABYLON={}));__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(n){var i=function(t){function i(r,u,f,e,o,s,h,c,l){void 0===e&&(e=0);void 0===o&&(o=i.EMISSION_RATE);void 0===s&&(s=.01);void 0===h&&(h=null);void 0===c&&(c=null);void 0===l&&(l=null);var a=t.call(this,r,u,f,l)||this;return a.emitType=i.EMISSION_RATE,a.loopPlay=!1,a.delayTime=0,a._duration=0,a._startSpeed=-1,a._enableTime=!1,a._cycleHandler=null,a._emissionBurst=null,a._updateModules=null,a._duration=e,a._startSpeed=s,a._emissionBurst=h,a._updateModules=null!=c?c:new n.ShurikenUpdateModules,a.delayTime=0,a.loopPlay=!1,a.emitType=o,a.updateSpeed=s,a.disposeOnStop=!1,a.preventAutoStart=!0,a.targetStopDuration=0,a.updateFunction=a.defaultUpdateOverTimeFunctionHandler,a.startPositionFunction=a.defaultStartPositionFunctionHandler,a.startDirectionFunction=a.defaultStartDirectionFunctionHandler,a.manualEmitCount=a.emitType===i.EMISSION_BURST?0:-1,a}return __extends(i,t),Object.defineProperty(i,"EMISSION_RATE",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(i,"EMISSION_BURST",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"modules",{get:function(){return this._updateModules},enumerable:!0,configurable:!0}),i.prototype.start=function(){var n=this,t,r;(this.internalStop(!1),this.updateSpeed=this._startSpeed,this.disposeOnStop=!1,this.preventAutoStart=!0,this.targetStopDuration=0,this.emitType===i.EMISSION_BURST?null!=this._emissionBurst&&this._emissionBurst.length>0&&this._emissionBurst.forEach(function(t){n.internalPlay(n.delayTime+t.time,t.minCount,t.maxCount)}):this.internalPlay(this.delayTime),this._duration>0)&&(t=this.delayTime+this._duration,null!=this._updateModules&&this._updateModules.updateOverTime===!0&&null!=this.animations&&this.animations.length>0&&(r=t*this._updateModules.framesPerSecond,this._cycleHandler=this.internalScene.beginAnimation(this,0,r,!1,1)),window.setTimeout(function(){n.internalCycle()},1e3*t))},i.prototype.stop=function(){this.internalStop(!0)},i.prototype.dispose=function(){this.internalStop(!0);this._emissionBurst=null;this._updateModules=null;this.updateFunction=null;this.startPositionFunction=null;this.startDirectionFunction=null;t.prototype.dispose.call(this)},Object.defineProperty(i.prototype,"internalScene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),i.prototype.internalPlay=function(n,t,i){var r=this;void 0===n&&(n=0);void 0===t&&(t=-1);void 0===i&&(i=-1);n>0?window.setTimeout(function(){r.internalStart(t,i)},1e3*n):this.internalStart(t,i)},i.prototype.internalCycle=function(){this.stop();this.loopPlay===!0&&this.start()},i.prototype.internalStart=function(r,u){var f=this.emitType===i.EMISSION_BURST?0:-1;this.emitType===i.EMISSION_BURST&&r>=1&&u>=1&&(f=n.Scalar.RandomRange(r,u));this.manualEmitCount=f;t.prototype.start.call(this)},i.prototype.internalStop=function(n){if(void 0===n&&(n=!1),null!=this._cycleHandler&&(this._cycleHandler.stop(),this._cycleHandler=null),n===!1){var i=this;null!=i&&i._started&&!i._stopped&&t.prototype.stop.call(this)}else t.prototype.stop.call(this)},i.prototype.getParticles=function(){return this.particles},Object.defineProperty(i.prototype,"stockParticles",{get:function(){return this._stockParticles},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaledUpdateSpeed",{get:function(){return this._scaledUpdateSpeed},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaledDirection",{get:function(){return this._scaledDirection},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaledColorStep",{get:function(){return this._scaledColorStep},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaledGravity",{get:function(){return this._scaledGravity},enumerable:!0,configurable:!0}),i.prototype.recycleParticle=function(n){null!=this._updateModules;t.prototype.recycleParticle.call(this,n)},i.prototype.defaultStartDirectionFunctionHandler=function(t,i,r){null!=this._updateModules;var u=n.Scalar.RandomRange(this.direction1.x,this.direction2.x),f=n.Scalar.RandomRange(this.direction1.y,this.direction2.y),e=n.Scalar.RandomRange(this.direction1.z,this.direction2.z);n.Vector3.TransformNormalFromFloatsToRef(u*t,f*t,e*t,i,r)},i.prototype.defaultStartPositionFunctionHandler=function(t,i){null!=this._updateModules;var r=n.Scalar.RandomRange(this.minEmitBox.x,this.maxEmitBox.x),u=n.Scalar.RandomRange(this.minEmitBox.y,this.maxEmitBox.y),f=n.Scalar.RandomRange(this.minEmitBox.z,this.maxEmitBox.z);n.Vector3.TransformCoordinatesFromFloatsToRef(r,u,f,t,i)},i.prototype.defaultUpdateOverTimeFunctionHandler=function(n){var i,t;for(null!=this._updateModules,i=0;i<n.length;i++)t=n[i],t.age+=this.scaledUpdateSpeed,t.age>=t.lifeTime?(this.recycleParticle(t),i--):(t.colorStep.scaleToRef(this.scaledUpdateSpeed,this.scaledColorStep),t.color.addInPlace(this.scaledColorStep),t.color.a<0&&(t.color.a=0),t.angle+=t.angularSpeed*this.scaledUpdateSpeed,t.direction.scaleToRef(this.scaledUpdateSpeed,this.scaledDirection),t.position.addInPlace(this.scaledDirection),this.gravity.scaleToRef(this.scaledUpdateSpeed,this.scaledGravity),t.direction.addInPlace(this.scaledGravity))},i}(n.ParticleSystem),t;n.ShurikenParticleSystem=i;t=function(){function n(){this.updateOverTime=!1;this.framesPerSecond=30;this.speedModule=null;this.emissionModule=null;this.velocityModule=null;this.colorModule=null;this.sizingModule=null;this.rotationModule=null;this.updateEffectTime=!1;this.maximumEffectTime=0}return n}();n.ShurikenUpdateModules=t}(BABYLON||(BABYLON={}));__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(n){var t=function(t){function i(i,r,u,f){var e,o;return void 0===u&&(u=!0),void 0===f&&(f={}),e=t.call(this,i,r,u,f)||this,(e._state=null,e._speed=1,e._entry=null,e._machine=null,e._enabled=!1,e._handlers=null,e._blending=0,e._autoplay=!1,e._executed=!1,e._checkers=new n.TransitionCheck,e._rootSpeed=0,e._rootRotation=0,e._rootVelocity=n.Vector3.Zero(),e.autoTicking=!0,e.onStateChanged=null,e._state=null,e._entry=null,e._handlers={},e._machine=null,e._executed=!1,e._enabled=e.getProperty("enableStateMachine",!1),e._blending=e.getProperty("defaultBlending",0),e._autoplay=e.getProperty("automaticPlay",!1),null!=e.owned.metadata&&(e.owned.metadata.state={},e.owned.metadata.state.floats={},e.owned.metadata.state.booleans={},e.owned.metadata.state.triggers={},e.owned.metadata.state.parameters={},null!=e.owned.metadata.properties&&null!=e.owned.metadata.properties.stateMachineInfo&&(e._machine=e.owned.metadata.properties.stateMachineInfo,null!=e._machine&&(null!=e._machine.speed&&(e._speed=e._machine.speed),null!=e._machine.entry&&""!==e._machine.entry&&(e._entry=e._machine.entry),null!=e._machine.parameters&&e._machine.parameters.length>0))))&&(o=e._machine.parameters,o.forEach(function(t){var i=t.name,r=t.type,u=(t.curve,t.defaultFloat),f=t.defaultBool,o=t.defaultInt;e.owned.metadata.state.parameters[i]=r;r===n.AnimatorParameterType.Float?e.setNumber(i,u):r===n.AnimatorParameterType.Int?e.setNumber(i,o):r===n.AnimatorParameterType.Bool?e.setBoolean(i,f):r===n.AnimatorParameterType.Trigger&&e.resetTrigger(i)})),e}return __extends(i,t),Object.defineProperty(i.prototype,"executing",{get:function(){return this._executed},enumerable:!0,configurable:!0}),i.prototype.start=function(){this.startStateMachine()},i.prototype.update=function(){this.autoTicking===!0&&this.updateStateMachine()},i.prototype.destroy=function(){this.destroyStateMachine()},i.prototype.tickStateMachine=function(){this.autoTicking===!1?this.updateStateMachine():n.Tools.Warn("Manual tick request ignored. Auto ticking is enabled for animator: "+this.owned.name)},i.prototype.getNumber=function(n){var t=0;return null!=this.owned.metadata&&null!=this.owned.metadata.state&&null!=this.owned.metadata.state.floats&&null!=this.owned.metadata.state.floats[n]&&(t=this.owned.metadata.state.floats[n]),t},i.prototype.setNumber=function(n,t){null!=this.owned.metadata&&null!=this.owned.metadata.state&&null!=this.owned.metadata.state.floats&&(this.owned.metadata.state.floats[n]=t)},i.prototype.getBoolean=function(n){var t=!1;return null!=this.owned.metadata&&null!=this.owned.metadata.state&&null!=this.owned.metadata.state.booleans&&null!=this.owned.metadata.state.booleans[n]&&(t=this.owned.metadata.state.booleans[n]),t},i.prototype.setBoolean=function(n,t){null!=this.owned.metadata&&null!=this.owned.metadata.state&&null!=this.owned.metadata.state.booleans&&(this.owned.metadata.state.booleans[n]=t)},i.prototype.getTrigger=function(n){var t=!1;return null!=this.owned.metadata&&null!=this.owned.metadata.state&&null!=this.owned.metadata.state.triggers&&null!=this.owned.metadata.state.triggers[n]&&(t=this.owned.metadata.state.triggers[n]),t},i.prototype.setTrigger=function(n){null!=this.owned.metadata&&null!=this.owned.metadata.state&&null!=this.owned.metadata.state.triggers&&(this.owned.metadata.state.triggers[n]=!0)},i.prototype.resetTrigger=function(n){null!=this.owned.metadata&&null!=this.owned.metadata.state&&null!=this.owned.metadata.state.triggers&&(this.owned.metadata.state.triggers[n]=!1)},i.prototype.getCurrentState=function(){return this._state},i.prototype.setCurrentState=function(n,t){void 0===t&&(t=0);this.setCurrentMachineState(n,t)},i.prototype.onAnimationEvent=function(n,t){null!=n&&""!==n&&(this._handlers[n.toLowerCase()]=t)},i.prototype.getAnimationEventHandler=function(n){var i=null,t;return null!=n&&""!==n&&(t=this._handlers[n.toLowerCase()],null!=t&&(i=t)),i},i.prototype.getRootMotionSpeed=function(){return this._rootSpeed},i.prototype.getRootMotionRotation=function(){return this._rootRotation},i.prototype.getRootMotionVelocity=function(){return this._rootVelocity},i.prototype.startStateMachine=function(){this._executed===!1&&(this._executed=!0,this._enabled===!0?this._autoplay===!0&&null!=this._entry&&""!==this._entry&&this.setCurrentMachineState(this._entry,0):this._autoplay===!0&&this.manager.playAnimationClip(null,this.owned))},i.prototype.updateStateMachine=function(){var t=this;this._checkers.result=null;this._checkers.offest=0;this._checkers.blending=0;this._checkers.triggered=[];null!=this._state&&(this.checkStateTransitions(this._state.transitions,this._state.time,this._state.length,this._state.rate,this._state.index),null==this._checkers.result&&null!=this._machine.transitions&&this.checkStateTransitions(this._machine.transitions,this._state.time,this._state.length,this._state.rate,this._state.index),null==this._checkers.result&&this._state.type===n.MotionType.Tree&&this.updateBlendingTree());this.validateRootMotion();null!=this._checkers.triggered&&this._checkers.triggered.length>0&&(this._checkers.triggered.forEach(function(n){t.resetTrigger(n)}),this._checkers.triggered=null);null!=this._checkers.result&&(this._checkers.offest>0?this.manager.delay(function(){t.setCurrentMachineState(t._checkers.result,t._checkers.blending)},1e3*this._checkers.offest):this.setCurrentMachineState(this._checkers.result,this._checkers.blending))},i.prototype.checkStateTransitions=function(t,i,r,u,f){var s=this,h,e,o,a;if(null!=t&&t.length>0)for(h=0,h=0;h<t.length;h++)if(e=t[h],e.indexLayer===f&&e.mute!==!0){var c=!1,v=n.Scalar.Denormalize(e.exitTime,0,r),l=this.manager.time-i>=v;if((e.hasExitTime!==!0||e.intSource!=n.InterruptionSource.None||l!==!1)&&(null!=e.conditions&&e.conditions.length>0?(o=0,a=e.conditions.length,e.conditions.forEach(function(t){var i,r,u,f;null!=s.owned.metadata.state.parameters[t.parameter]&&(i=s.owned.metadata.state.parameters[t.parameter],i==n.AnimatorParameterType.Float||i==n.AnimatorParameterType.Int?(r=s.getNumber(t.parameter),t.mode===n.ConditionMode.Greater&&r>t.threshold?o++:t.mode===n.ConditionMode.Less&&r<t.threshold?o++:t.mode===n.ConditionMode.Equals&&r===t.threshold?o++:t.mode===n.ConditionMode.NotEqual&&r!==t.threshold&&o++):i==n.AnimatorParameterType.Bool?(u=s.getBoolean(t.parameter),t.mode===n.ConditionMode.If&&u===!0?o++:t.mode===n.ConditionMode.IfNot&&u===!1&&o++):i==n.AnimatorParameterType.Trigger&&(f=s.getTrigger(t.parameter),f===!0&&(o++,s._checkers.triggered.indexOf(t.parameter)<0&&s._checkers.triggered.push(t.parameter))))}),c=e.hasExitTime===!0?l===!0&&o===a:o===a):c=e.hasExitTime===!0&&l===!0,c===!0)){var y=e.isExit===!1?e.destination:n.AnimationState.EXIT,p=n.Scalar.Denormalize(e.offset,0,r),w=n.Scalar.Denormalize(e.duration,0,r),b=n.Utilities.ComputeBlendingSpeed(u,w);this._checkers.result=y;this._checkers.offest=p;this._checkers.blending=b;break}}},i.prototype.getMachineStateInfo=function(n){var t=0,r=null,u,f,i;if(null!=this._machine&&null!=this._machine.states&&this._machine.states.length>0)for(u=this._machine.states,f=this._machine.states.length,t=0;t<f;t++)if(i=u[t],null!=i&&i.name===n){r=i;break}return r},i.prototype.setCurrentMachineState=function(t,i){null!=t&&""!==t&&t!==n.AnimationState.EXIT&&(null!=this._state&&this._state.name===t||(this.resetMachineState(this._state),this._state=this.getMachineStateInfo(t),null!=this._state&&(this._state.time=this.manager.time,this._state.type===n.MotionType.Clip&&null!=this._state.motion&&""!==this._state.motion&&(this._state.animations=this.manager.playAnimationClip(this._state.motion,this.owned,i,this._state.speed*this._speed,!0)),null!=this.onStateChanged&&this.onStateChanged())))},i.prototype.resetMachineState=function(n){null!=n&&(n.time=0,n.branch=null,n.animations=null,n.interupted=!1)},i.prototype.destroyStateMachine=function(){this.resetMachineState(this._state);this.onStateChanged=null;null!=this.owned.metadata&&null!=this.owned.metadata.state&&(this.owned.metadata.state=null);this._state=null},i.prototype.updateBlendingTree=function(){if(null!=this._state&&null!=this._state.blendtree){var n=this.getBlendTreeBranch(this._state.blendtree);null!=n&&null!=n.motion&&""!==n.motion&&this._state.branch!==n.motion&&(this._state.branch=n.motion,this._state.animations=this.manager.playAnimationClip(n.motion,this.owned,this._blending,n.timescale*this._state.speed*this._speed,!0))}},i.prototype.getBlendTreeBranch=function(t){var f=null,u,i;if(null!=t.children&&t.children.length>0)for(var r=0,e=this.getNumber(t.blendParameterX),o=this.getNumber(t.blendParameterY),r=0;r<t.children.length;r++)if(u=!1,i=t.children[r],this._state.blendtree.blendType===n.BlendTreeType.Simple1D?u=e===i.threshold:null!=i.position&&i.position.length>=2&&(u=e===i.position[0]&&o===i.position[1]),u===!0&&(f=i.type===n.MotionType.Tree?this.getBlendTreeBranch(i.subtree):i),null!=f)break;return f},i.prototype.validateRootMotion=function(){null!=this._state&&null!=this._state.averageSpeed&&this._state.averageSpeed.length>=3?(this._rootSpeed=this._state.averageSpeed[2],this._rootRotation=this._state.averageAngularSpeed,this._rootVelocity.copyFromFloats(this._state.averageSpeed[0],this._state.averageSpeed[1],this._state.averageSpeed[2])):(this._rootSpeed=0,this._rootRotation=0,this._rootVelocity.copyFromFloats(0,0,0))},i.EXIT="[EXIT]",i}(n.SceneComponent);n.AnimationState=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(){}return t.Angle=function(t,i){return 57.29578*Math.acos(n.Scalar.Clamp(n.Vector3.Dot(t.normalize(),i.normalize()),-1,1))},t.Euler=function(t,i,r){return n.Quaternion.RotationYawPitchRoll(i,t,r)},t.EulerToRef=function(t,i,r,u){n.Quaternion.RotationYawPitchRollToRef(i,t,r,u)},t.Matrix=function(t,i,r){return n.Matrix.RotationYawPitchRoll(i,t,r)},t.MatrixToRef=function(t,i,r,u){n.Matrix.RotationYawPitchRollToRef(i,t,r,u)},t.ClampAngle=function(t,i,r){var u=t;do u<-360&&(u+=360),u>360&&(u-=360);while(u<-360||u>360);return n.Scalar.Clamp(u,i,r)},t.RotateVector=function(t,i){var r=2*(i.y*t.z-i.z*t.y),u=2*(i.z*t.x-i.x*t.z),f=2*(i.x*t.y-i.y*t.x);return new n.Vector3(t.x+i.w*r+(i.y*f-i.z*u),t.y+i.w*u+(i.z*r-i.x*f),t.z+i.w*f+(i.x*u-i.y*r))},t.RotateVectorToRef=function(n,t,i){var r=2*(t.y*n.z-t.z*n.y),u=2*(t.z*n.x-t.x*n.z),f=2*(t.x*n.y-t.y*n.x);i.x=n.x+t.w*r+(t.y*f-t.z*u);i.y=n.y+t.w*u+(t.z*r-t.x*f);i.z=n.z+t.w*f+(t.x*u-t.y*r)},t.MoveTowardsVector=function(n,t,i){var r,f=t.subtract(n),u=f.length();return(u<=i||0===u)&&(r=t),r},t.MoveTowardsAngle=function(t,i,r){var u,f=n.Scalar.DeltaAngle(t,i);return-r<f&&f<r?u=i:(i=t+f,u=n.Scalar.MoveTowards(t,i,r)),u},t.TransformPosition=function(t,i){return n.Vector3.TransformCoordinates(i,t.getWorldMatrix())},t.TransformPositionToRef=function(t,i,r){return n.Vector3.TransformCoordinatesToRef(i,t.getWorldMatrix(),r)},t.TransformDirection=function(t,i){return n.Vector3.TransformNormal(i,t.getWorldMatrix())},t.TransformDirectionToRef=function(t,i,r){return n.Vector3.TransformNormalToRef(i,t.getWorldMatrix(),r)},t.GetDirectionVector=function(n,t){return n.getDirection(t)},t.GetDirectionVectorToRef=function(n,t,i){n.getDirectionToRef(t,i)},t.GetForwardVector=function(t){return t.getDirection(n.Vector3.Forward())},t.GetForwardVectorToRef=function(t,i){t.getDirectionToRef(n.Vector3.Forward(),i)},t.GetRightVector=function(t){return t.getDirection(n.Vector3.Right())},t.GetRightVectorToRef=function(t,i){t.getDirectionToRef(n.Vector3.Right(),i)},t.GetUpVector=function(t){return t.getDirection(n.Vector3.Up())},t.GetUpVectorToRef=function(t,i){t.getDirectionToRef(n.Vector3.Up(),i)},t.GetQuaternionForwardVector=function(t){return new n.Vector3(2*(t.x*t.z+t.w*t.y),2*(t.y*t.x-t.w*t.x),1-2*(t.x*t.x+t.y*t.y))},t.GetQuaternionForwardVectorToRef=function(n,t){null!=t&&(t.x=2*(n.x*n.z+n.w*n.y),t.y=2*(n.y*n.x-n.w*n.x),t.z=1-2*(n.x*n.x+n.y*n.y))},t.GetQuaternionRightVector=function(t){return new n.Vector3(1-2*(t.y*t.y+t.z*t.z),2*(t.x*t.y+t.w*t.z),2*(t.x*t.z-t.w*t.y))},t.GetQuaternionRightVectorToRef=function(n,t){null!=t&&(t.x=1-2*(n.y*n.y+n.z*n.z),t.y=2*(n.x*n.y+n.w*n.z),t.z=2*(n.x*n.z-n.w*n.y))},t.GetQuaternionUpVector=function(t){return new n.Vector3(2*(t.x*t.y-t.w*t.z),1-2*(t.x*t.x+t.z*t.z),2*(t.y*t.z+t.w*t.x))},t.GetQuaternionUpVectorToRef=function(n,t){null!=t&&(t.x=2*(n.x*n.y-n.w*n.z),t.y=1-2*(n.x*n.x+n.z*n.z),t.z=2*(n.y*n.z+n.w*n.x))},t.ComputeBlendingSpeed=function(n,t){return 1/(n*t)},t.ParseColor3=function(t,i){void 0===i&&(i=null);return null!=t&&null!=t.r&&null!=t.g&&null!=t.b?new n.Color3(t.r,t.g,t.b):i},t.ParseColor4=function(t,i){void 0===i&&(i=null);return null!=t&&null!=t.r&&null!=t.g&&null!=t.b&&null!=t.a?new n.Color4(t.r,t.g,t.b,t.a):i},t.ParseVector2=function(t,i){void 0===i&&(i=null);return null!=t&&null!=t.x&&null!=t.y?new n.Vector2(t.x,t.y):i},t.ParseVector3=function(t,i){void 0===i&&(i=null);return null!=t&&null!=t.x&&null!=t.y&&null!=t.z?new n.Vector3(t.x,t.y,t.z):i},t.ParseVector4=function(t,i){void 0===i&&(i=null);return null!=t&&null!=t.x&&null!=t.y&&null!=t.z&&null!=t.w?new n.Vector4(t.x,t.y,t.z,t.w):i},t.StartsWith=function(n,t){return 0===n.lastIndexOf(t,0)},t.EndsWith=function(n,t){return n.indexOf(t,n.length-t.length)!==-1},t.ReplaceAll=function(n,t,i){return n.replace(new RegExp(t,"g"),i)},t.EncodeBinay=function(t){var i=null,r=window;return r.msgpack?i=r.msgpack.encode(t):n.Tools.Warn("Failed to load msgpack library."),i},t.DecodeBinary=function(t){var i=null,r=window;return r.msgpack?i=r.msgpack.decode(t):n.Tools.Warn("Failed to load msgpack library."),null!=i?i:null},t.CompressToString=function(t){var i=null,r=window;return r.pako?i=r.pako.deflate(t,{to:"string"}):n.Tools.Warn("Failed to load pako library."),i},t.CompressToArray=function(t){var i=null,r=window;return r.pako?i=r.pako.deflate(t):n.Tools.Warn("Failed to load pako library."),i},t.DecompressToString=function(t){var i=null,r=window;return r.pako?i=r.pako.inflate(t,{to:"string"}):n.Tools.Warn("Failed to load pako library."),i},t.DecompressToArray=function(t){var i=null,r=window;return r.pako?i=r.pako.inflate(t):n.Tools.Warn("Failed to load pako library."),i},t}();n.Utilities=t}(BABYLON||(BABYLON={}))